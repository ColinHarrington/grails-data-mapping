<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
    <head>
        <title>GORM for Cassandra 1.0.0</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
        <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />
    <script type="text/javascript">
function addJsClass(el) {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
    </head>

    <body class="body" onload="addJsClass();">
        <div id="navigation">
            <ul>
                <li>
                    <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                        <a href="../guide/index.html" class="button">Table of contents</a>
                        <div id="nav-summary-childs" style="display:none;">
                            
                            <div class="toc-item" style="margin-left:0"><a href="#1.%20Introduction"><strong>1</strong><span>Introduction</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#2.%20Getting%20Started"><strong>2</strong><span>Getting Started</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#3.%20Mapping%20Domain%20Classes%20to%20Cassandra%20Tables"><strong>3</strong><span>Mapping Domain Classes to Cassandra Tables</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#4.%20Querying%20and%20Persistence%20Options"><strong>4</strong><span>Querying and Persistence Options</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#5.%20Low-level%20API"><strong>5</strong><span>Low-level API</span></a></div>
                            
                        </div>
                    </div>
                </li>
                <li class="separator selected">
                    <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
                </li>
            </ul>
        </div>
        <div id="header">
            <div class="images clearfix">
                
                
            </div>
            <p></p>
        </div>


        <table id="colset" border="0" cellpadding="0" cellspacing="0">
            <tr>
                <td id="col1">
                    <div id="main" class="corner-all">

                        <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                        <div class="project">
                            <h1>GORM for Cassandra - Reference Documentation</h1>
                            <p><strong>Authors:</strong> Paras Lakhani</p>
                            <p><strong>Version:</strong> 1.0.0</p>
                            
                        </div>

                        
                        <div id="table-of-content">
                            <h2>Table of Contents</h2>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#1.%20Introduction"><strong>1</strong><span>Introduction</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#1.1%20Compatibility%20with%20GORM%20for%20Hibernate"><strong>1.1</strong><span>Compatibility with GORM for Hibernate</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#1.2%20Release%20Notes"><strong>1.2</strong><span>Release Notes</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#2.%20Getting%20Started"><strong>2</strong><span>Getting Started</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#2.1%20Using%20Cassandra%20Standalone"><strong>2.1</strong><span>Using Cassandra Standalone</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#2.2%20Combining%20Cassandra%20and%20Hibernate"><strong>2.2</strong><span>Combining Cassandra and Hibernate</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#2.3%20Advanced%20Configuration"><strong>2.3</strong><span>Advanced Configuration</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#3.%20Mapping%20Domain%20Classes%20to%20Cassandra%20Tables"><strong>3</strong><span>Mapping Domain Classes to Cassandra Tables</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#3.1%20Identity%20Generation"><strong>3.1</strong><span>Identity Generation</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#3.2%20Compound%20Primary%20Key"><strong>3.2</strong><span>Compound Primary Key</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#3.2%20Indexing%20Queries"><strong>3.3</strong><span>Indexing Queries</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#3.3%20Table%20Properties"><strong>3.4</strong><span>Table Properties</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#3.4%20Stateful%20vs.%20Stateless%20Domain%20Classes"><strong>3.5</strong><span>Stateful vs. Stateless Domain Classes</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#4.%20Querying%20and%20Persistence%20Options"><strong>4</strong><span>Querying and Persistence Options</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#4.1%20Querying%20Options"><strong>4.1</strong><span>Querying Options</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#5.%20Low-level%20API"><strong>5</strong><span>Low-level API</span></a></div>
                            
                            <div style="clear:both" ></div>
                        </div>
                        
                        

<h1 id="1. Introduction">1 Introduction</h1>
Apache Cassandra is a massively scalable open source NoSQL database.<p class="paragraph"/>Cassandra can be used for managing large amounts of data across multiple data centers and the cloud.<p class="paragraph"/>The goal of this grails-data-mapping subproject is to provide a 'as-complete-as-possible' GORM implemenatition that maps domain classes and instances to Cassandra 2.0 tables.<p class="paragraph"/>This project aims to provide an object-mapping layer on top of Cassandra to ease common activities such as:
<ul class="star">
<li>Marshalling from Cassandra to Groovy/Java types and back again</li>
<li>Support for GORM dynamic finders, criteria and named queries</li>
<li>Session-managed transactions</li>
<li>Validating domain instances backed by the Cassandra datastore</li>
<li>Cassandra schema creation</li>
</ul><p class="paragraph"/>


<h2 id="1.1 Compatibility with GORM for Hibernate">1.1 Compatibility with GORM for Hibernate</h2>
This implementation tries to be as compatible as possible with GORM for Hibernate. 
In general you can refer to the <a href="http://grails.org/doc/latest/guide/5.%20Object%20Relational%20Mapping%20(GORM).html" target="blank">GORM documentation</a> and the "Domain Classes" section of the <a href="http://grails.org/doc/latest/" target="blank">reference guide</a> (see the right nav) for usage information.<p class="paragraph"/>The following key features are supported by GORM for Cassandra:
<ul class="star">
<li>Simple persistence methods</li>
<li>Dynamic finders</li>
<li>Criteria queries</li>
<li>Named queries</li>
<li>Inheritance</li>
<li>Embedded types</li>
<li>Query by example</li>
</ul><p class="paragraph"/>However, some features are not supported:
<ul class="star">
<li>HQL queries</li>
<li>Associations (these should be supported in the future)</li>
<li>Any direct interaction with the Hibernate API</li>
<li>Custom Hibernate user types</li>
<li>Queries using OR, LIKE, NOT EQUAL, IS NULL, negation, property comparison, offset in paging, most projections (mainly because Cassandra itself doesn't support these)</li>
<li>Table-per-hierarchy mapping</li>
</ul><p class="paragraph"/>There may be other limitations not mentioned here so in general it shouldn't be expected that an application based on GORM for Hibernate will "just work" without some tweaking involved. Having said that, the large majority of common GORM functionality is supported.



<h2 id="1.2 Release Notes">1.2 Release Notes</h2>
Below are the details of the changes across releases:<p class="paragraph"/><h4>1.0.0 GA</h4>
<ul class="star">
<li>Initial feature complete 1.0 release</li>
</ul><p class="paragraph"/>


<h1 id="2. Getting Started">2 Getting Started</h1>
To get started with GORM for Cassandra you need configure it as a dependency in <code>BuildConfig.groovy</code>:<p class="paragraph"/><div class="code"><pre>plugins &#123;
    compile ':cassandra:latest.version' 
&#125;</pre></div><p class="paragraph"/>With that done you need to set up a running Cassandra server. 
Refer to the <a href="https://wiki.apache.org/cassandra/GettingStarted" target="blank">Apache Cassandra Getting Started Guide</a> for an explanation on how to setup and startup a Cassandra instance. 
Once installed, starting Cassandra is typically a matter of executing the following command:<p class="paragraph"/><div class="code"><pre>CASSANDRA_HOME/bin/cassandra &#45;f</pre></div><p class="paragraph"/>With the above command executed in a terminal window you should see output like the following appear:<p class="paragraph"/><div class="code"><pre>INFO 00:11:16,935 Starting listening <span class="java&#45;keyword">for</span> CQL clients on localhost/127.0.0.1:9042&#8230;
INFO 00:11:17,013 Using TFramedTransport with a max frame size of 15728640 bytes.
INFO 00:11:17,014 Binding thrift service to localhost/127.0.0.1:9160
INFO 00:11:17,042 Using synchronous/threadpool thrift server on localhost : 9160
INFO 00:11:17,042 Listening <span class="java&#45;keyword">for</span> thrift clients...</pre></div><p class="paragraph"/>As you can see the server listens for CQL clients on port 9042, but don't worry the Cassandra plugin for Grails will automatically configure itself to look for Cassandra on that port by default.<p class="paragraph"/>If you want to configure how Grails connects to Cassandra then you can do so using the following settings in <code>grails-app/conf/DataSource.groovy</code>:<p class="paragraph"/><div class="code"><pre>grails &#123;
    cassandra &#123;  
        contactPoints = <span class="java&#45;quote">"localhost"</span> 
        port = 9042 
        keyspace.name = <span class="java&#45;quote">"foo"</span> 		
    &#125;
&#125;</pre></div>



<h2 id="2.1 Using Cassandra Standalone">2.1 Using Cassandra Standalone</h2>
If you plan to use Cassandra as your primary datastore then you need to remove the Hibernate plugin from the <code>grails-app/conf/BuildConfig.groovy</code> file by commenting out the hibernate line in the plugins block<p class="paragraph"/><div class="code"><pre>compile ':hibernate:3.6.10.12'</pre></div><p class="paragraph"/>With this done all domain classes in grails-app/domain will be persisted via Cassandra and not Hibernate. You can create a domain class by running the regular <code>create-domain-class</code> command:<p class="paragraph"/><div class="code"><pre>grails create&#45;domain&#45;class Person</pre></div><p class="paragraph"/>The <code>Person</code> domain class will automatically be a persistent entity that can be stored in Cassandra.



<h2 id="2.2 Combining Cassandra and Hibernate">2.2 Combining Cassandra and Hibernate</h2>
If you have both the Hibernate and Cassandra plugins installed then by default all classes in the <code>grails-app/domain</code> directory will be persisted by Hibernate and not Cassandra. 
If you want to persist a particular domain class with Cassandra then you must use the <code>mapWith</code> property in the domain class:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> mapWith = <span class="java&#45;quote">"cassandra"</span></pre></div><p class="paragraph"/>Alternatively you can persist Hibernate entities to Cassandra using the special <code>cassandra</code> scope added to all Hibernate entities.<p class="paragraph"/><div class="code"><pre>person.cassandra.save()</pre></div><p class="paragraph"/>By default the Hibernate plugin transparently adds an implicit <code>id</code> property of type <code>Long</code> to your domain class. The Cassandra plugin adds an <code>id</code> property of type <code>UUID</code>. 
If you install both plugins the <code>id</code> property will be of type <code>Long</code>.
If you have a domain class with auto-generated <code>id</code> (the default) and you want to save it to both datastores, you should set a <code>String id</code> property.
Example of persisting an entity to both datastores:
<div class="code"><pre>class Person &#123;
    <span class="java&#45;object">String</span> id
    <span class="java&#45;object">String</span> firstName
    <span class="java&#45;object">String</span> lastName     
&#125;<p class="paragraph"/>def hibernatePerson = <span class="java&#45;keyword">new</span> Person(firstName: <span class="java&#45;quote">"Fred"</span>, lastName: <span class="java&#45;quote">"Flintstone"</span>).save(flush:<span class="java&#45;keyword">true</span>)<p class="paragraph"/>hibernatePerson = Person.get(1)<p class="paragraph"/>hibernatePerson.cassandra.insert()<p class="paragraph"/>def cassandraPerson = Person.cassandra.get(1)</pre></div><p class="paragraph"/>Because a <code>Long id</code> won't really work for Cassandra, you can explicitly add a <code>UUID id</code> property, and set the id's <code>generator</code> attribute so the Hibernate plugin can auto-generate a <code>UUID</code>.<p class="paragraph"/>Example:<p class="paragraph"/><div class="code"><pre>class Person &#123;
    UUID id
    <span class="java&#45;object">String</span> firstName
    <span class="java&#45;object">String</span> lastName 
    <span class="java&#45;keyword">static</span> mapping = &#123;
        id generator:'uuid2'        
    &#125;   
&#125;<p class="paragraph"/>def hibernatePerson = <span class="java&#45;keyword">new</span> Person(firstName: <span class="java&#45;quote">"Fred"</span>, lastName: <span class="java&#45;quote">"Flintstone"</span>).save(flush:<span class="java&#45;keyword">true</span>)<p class="paragraph"/>hibernatePerson = Person.get(uuid)<p class="paragraph"/>hibernatePerson.cassandra.insert()<p class="paragraph"/>def cassandraPerson = Person.cassandra.get(uuid)</pre></div><p class="paragraph"/>Note that as an identifier has been assigned to the entity by the Hibernate plugin, you will need to use the <code>insert</code> method for Cassandra instead of the <code>save</code> method, 
otherwise GORM can't work out whether you are trying to achieve an insert or an update.


<h2 id="2.3 Advanced Configuration">2.3 Advanced Configuration</h2>
<h4>Cassandra Database Connection Configuration</h4><p class="paragraph"/>As mentioned the GORM for Cassandra plugin will configure all the defaults for you, but if you wish to customize those defaults you can do so in the <code>grails-app/conf/DataSource.groovy</code> file:<p class="paragraph"/><div class="code"><pre>grails &#123;
    cassandra &#123;
        contactPoints = <span class="java&#45;quote">"localhost"</span>
        port = 9042
        schemaAction = <span class="java&#45;quote">"recreate&#45;drop&#45;unused"</span>
        keyspace &#123;
            name = <span class="java&#45;quote">"foo"</span> 
            action = <span class="java&#45;quote">"create"</span>
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/>The <code>keyspace name</code> property configures the default keyspace to use. If it's not specified the <code>keyspace</code> used will default to the name of your application.<p class="paragraph"/>In production scenarios you will typically use more than one Cassandra node:<p class="paragraph"/><div class="code"><pre>grails &#123;
    cassandra &#123;
        contactPoints = <span class="java&#45;quote">"192.168.0.1, 192.168.0.2"</span> //comma&#45;separated list of hostnames or IP addresses of nodes to connect to
    &#125;
&#125;</pre></div><p class="paragraph"/><h4>Keyspace creation</h4><p class="paragraph"/>If you want the plugin to automatically create the application's keyspace you can specify a value for the <code>keyspace action</code> property:<p class="paragraph"/><div class="code"><pre>grails &#123;
    cassandra &#123;
        keyspace &#123;
            name = <span class="java&#45;quote">"foo"</span> 
            action = <span class="java&#45;quote">"create"</span>
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/>Valid options for <code>action</code> are:
<ul class="star">
<li><strong class="bold">create</strong> - Create the keyspace if it doesn't exist</li>
<li><strong class="bold">create-drop</strong> - Drop the keyspace and create it if doesn't exist</li>
</ul><p class="paragraph"/><h4>Schema creation</h4><p class="paragraph"/>The plugin can automatically create the Cassandra tables and indexes required for your domain model. You have some control over when and how it does this through the <code>dbCreate</code> property, which can take these values: 
<ul class="star">
<li><strong class="bold">none</strong> - The default. Do not create any schema objects.</li>
<li><strong class="bold">create</strong> - Create a table and indexes for each domain class on startup. Fail if a table already exists.</li>
<li><strong class="bold">recreate</strong> - Create a table and indexes for each domain class on startup, dropping the table first if it exists.</li>
<li><strong class="bold">recreate-drop-unused</strong> - Drop <strong class="bold">all</strong> tables in the keyspace, then create a table and indexes for each domain class on startup.</li>
<li>update - TO IMPLEMENT</li>
</ul><p class="paragraph"/>Example:
<div class="code"><pre>grails &#123;
    cassandra &#123;
        dbCreate = <span class="java&#45;quote">"recreate&#45;drop&#45;unused"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>You can remove the dbCreate property completely, which is recommended once your schema is relatively stable and definitely when your application and database are deployed in production.<p class="paragraph"/><h4>Configuration Options Guide</h4><p class="paragraph"/>Below is a complete example showing all configuration options, including <a href="http://www.datastax.com/documentation/cql/3.1/cql/cql_reference/create_keyspace_r.html" target="blank">keyspace options</a>:<p class="paragraph"/><div class="code"><pre>grails &#123;
    cassandra &#123;
    	contactPoints = <span class="java&#45;quote">"localhost"</span> //comma&#45;separated list of hostnames or IP addresses of nodes to connect to
        port = 9042 //the port to connect to
        dbCreate = <span class="java&#45;quote">"recreate"</span> //the strategy to create cassandra tables and indexes <span class="java&#45;keyword">for</span> domain classes, <span class="java&#45;keyword">default</span>: <span class="java&#45;quote">"none"</span>     
        stateless = <span class="java&#45;keyword">false</span> // whether to use stateless sessions by <span class="java&#45;keyword">default</span><p class="paragraph"/>        keyspace &#123;
            name = <span class="java&#45;quote">"foo"</span> //the name of the keyspace to use, <span class="java&#45;keyword">default</span>: the name of the application
            action = <span class="java&#45;quote">"create"</span> //whether to create a keyspace, <span class="java&#45;keyword">default</span>: no keyspace created<p class="paragraph"/>            //keyspace properties to set only <span class="java&#45;keyword">if</span> the plugin is to create the keyspace         			
            durableWrites = <span class="java&#45;keyword">false</span> //<span class="java&#45;keyword">default</span>: <span class="java&#45;keyword">false</span>                        
            replicationStrategy = <span class="java&#45;quote">"SimpleStrategy"</span> OR <span class="java&#45;quote">"NetworkTopologyStrategy"</span> //<span class="java&#45;keyword">default</span>: <span class="java&#45;quote">"SimpleStrategy"</span>             
            replicationFactor = 1 //<span class="java&#45;keyword">default</span>: 1                        
            dataCenter = &#91;<span class="java&#45;quote">"us&#45;west"</span>:1, <span class="java&#45;quote">"eu&#45;west"</span>:2&#93; //<span class="java&#45;keyword">if</span> replicationStrategy is <span class="java&#45;quote">"NetworkTopologyStrategy"</span>,
                                                    //a map of data centre names and replication factors
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/>
<h4>Global Mapping Configuration</h4><p class="paragraph"/>Using the <code>grails.cassandra.default.mapping</code> setting in <code>Config.groovy</code> you can configure global mapping options across your domain classes. 
The following configuration will disable optimistic locking globally:<p class="paragraph"/><div class="code"><pre>grails.cassandra.<span class="java&#45;keyword">default</span>.mapping = &#123;
    version <span class="java&#45;keyword">false</span>    
&#125;</pre></div>



<h1 id="3. Mapping Domain Classes to Cassandra Tables">3 Mapping Domain Classes to Cassandra Tables</h1>
<h4>Basic Mapping</h4><p class="paragraph"/>The way the GORM for Cassandra plugin works is to map each domain class to a Cassandra table. For example given a domain class such as:<p class="paragraph"/><div class="code"><pre>class Person &#123;
    <span class="java&#45;object">String</span> firstName
    <span class="java&#45;object">String</span> lastName    
&#125;</pre></div><p class="paragraph"/>This will map onto a Cassandra table called "person" and generate the following table if schema creation is on:<p class="paragraph"/><div class="code"><pre>CREATE TABLE person (id uuid, firstname text, lastname text, version bigint, PRIMARY KEY (id));</pre></div><p class="paragraph"/>The plugin transparently adds an implicit <code>id</code> property of type UUID which is auto-generated when an entity is saved.<p class="paragraph"/><h4>Data types</h4>
In general a property's Java type maps onto a CQL3 data type as listed <a href="http://www.datastax.com/documentation/developer/java-driver/2.0/java-driver/reference/javaClass2Cql3Datatypes_r.html" target="blank">here</a>
Some Java types can map onto more than one CQL3 data type, the default mappings are shown in bold:
<ul class="star">
<li><code>java.util.UUID</code> - CQL <strong class="bold">uuid</strong> or <code>timeuuid</code></li>
<li><code>java.lang.String</code> - CQL <strong class="bold">text</strong> or <code>ascii</code> or <code>varchar</code></li>
<li><code>long</code> / <code>java.lang.Long</code> - CQL <strong class="bold">bigint</strong> or <code>counter</code></li>
</ul><p class="paragraph"/>Java <code>byte</code> and <code>short</code> map onto CQL <code>int</code>.<p class="paragraph"/>To map onto a different CQL type specify the <code>type</code> attribute in the mapping. Example:<p class="paragraph"/><div class="code"><pre>class Person &#123;
    <span class="java&#45;object">String</span> firstName
    <span class="java&#45;object">String</span> lastName
    UUID timeuuid    
    <span class="java&#45;object">String</span> ascii
    <span class="java&#45;object">String</span> varchar
    <span class="java&#45;object">long</span> counter<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        timeuuid type:<span class="java&#45;quote">"timeuuid"</span>
        ascii type:'ascii'
        varchar type:'varchar'   
        counter type:'counter'     
    &#125;       
&#125;</pre></div><p class="paragraph"/> 
<h4>Embedded Collections and Maps</h4><p class="paragraph"/>You can map embedded lists, sets and maps of standard CQL data types simply by defining the appropriate collection type:<p class="paragraph"/><div class="code"><pre>class Person &#123;
    <span class="java&#45;object">String</span> firstName
    <span class="java&#45;object">String</span> lastName    
    List&#60;<span class="java&#45;object">Integer</span>&#62; scores
    Set&#60;<span class="java&#45;object">String</span>&#62; friends
    Map&#60;<span class="java&#45;object">String</span>, <span class="java&#45;object">String</span>&#62; pets	    
&#125;<p class="paragraph"/>...<p class="paragraph"/><span class="java&#45;keyword">new</span> Person(friends:&#91;'Fred', 'Bob'&#93;, pets:&#91;chuck:<span class="java&#45;quote">"Dog"</span>, eddie:'Parrot'&#93;).save(flush:<span class="java&#45;keyword">true</span>)</pre></div><p class="paragraph"/>There are certain <a href="http://www.datastax.com/documentation/cql/3.1/cql/cql_using/use_collections_c.html" target="blank">limitations</a> on collections and only the standard CQL data types can be stored inside embedded collections and maps.<p class="paragraph"/>When persisting a domain class containing embedded collections or maps using the <code>save</code> method, the entire collection or map is saved or updated to Cassandra. 
This may not be appropriate if you only want to persist the non-collection properties, in which case you can use the <code>updateSimpleTypes</code> instance method.
Example:
<div class="code"><pre>def person = Person.get(uuid)
person.age = 31
person.updateSimpleTypes(flush:<span class="java&#45;keyword">true</span>)</pre></div><p class="paragraph"/>If you want to add or remove an item from a collection or map and only have that change updated to Cassandra you can use the various dynamic methods listed in the "Domain Classes" section of the right nav. 
Example:
<div class="code"><pre>person.prependToScores(5)
Person.appendToFriends(person.id, 'Barney')
Person.deleteFromPets(person.id, 'eddie', &#91;flush:<span class="java&#45;keyword">true</span>&#93;)</pre></div><p class="paragraph"/> 
<h4>Customized Database Mapping</h4><p class="paragraph"/>You may wish to customize how a domain class maps onto a Cassandra table. This is possible using the <code>mapping</code> block as follows:<p class="paragraph"/><div class="code"><pre>class Person &#123;
    ..
    <span class="java&#45;keyword">static</span> mapping = &#123;
        table <span class="java&#45;quote">"the_person"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>In this example we see that the <code>Person</code> entity has been mapped to a table called "the_person".<p class="paragraph"/>You can also control how an individual property maps onto a table column (the default is to use the property name itself):<p class="paragraph"/><div class="code"><pre>class Person &#123;
    ..
    <span class="java&#45;keyword">static</span> mapping = &#123;
        firstName column:<span class="java&#45;quote">"first_name"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><p class="paragraph"/>



<h2 id="3.1 Identity Generation">3.1 Identity Generation</h2>
By default in Cassandra GORM domain classes are supplied with a UUID-based identifier. So for example the following entity:<p class="paragraph"/><div class="code"><pre>class Person &#123;&#125;</pre></div><p class="paragraph"/>Has a property called <code>id</code> of type <code>java.util.UUID</code>. In this case GORM for Cassandra will generate a UUID identifier using java.util.UUID.randomUUID(). 
For a <code>timeuuid</code> it will generate one using the <a href="http://www.datastax.com/drivers/java/2.0/com/datastax/driver/core/utils/UUIDs.html#timeBased%28%29" target="blank">Java driver</a><p class="paragraph"/>You can name the <code>id</code> property something else, in which case you have to set the <code>name</code> attribute in the mapping:<p class="paragraph"/><div class="code"><pre>class Person &#123;
    UUID primary<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
    	id name:<span class="java&#45;quote">"primary"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><h4>Assigned Identifiers</h4><p class="paragraph"/>If you want to manually assign an identifier, the following mapping should be used:<p class="paragraph"/><div class="code"><pre>class Person &#123;
    <span class="java&#45;object">String</span> firstName
    <span class="java&#45;object">String</span> lastName<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        id name:<span class="java&#45;quote">"lastName"</span>, generator:<span class="java&#45;quote">"assigned"</span>
    &#125;       
&#125;</pre></div><p class="paragraph"/>Note that it is important to specify generator:"assigned" so GORM can work out whether you are trying to achieve an insert or an update. 
Example:<p class="paragraph"/><div class="code"><pre>def p = <span class="java&#45;keyword">new</span> Person(lastName:<span class="java&#45;quote">"Wilson"</span>)
// to insert
p.save()
// to update
p.save()</pre></div><p class="paragraph"/>An existing manually-assigned entity will only be updated with the <code>save</code> method if it is in the current persistence session. 
Otherwise GORM will try to insert the entity again, which will result in an upsert to Cassandra (with no version checking if versioning is on).
So if the entity is not in the session and you want to explicitly direct an update to Cassandra then use the <code>update</code> method instead of the <code>save</code> method. 
Example:<p class="paragraph"/><div class="code"><pre>def p = <span class="java&#45;keyword">new</span> Person(lastName:<span class="java&#45;quote">"Wilson"</span>)
// to insert
p.save()
session.clear() or p.discard()
// to update
p.update()</pre></div>


<h2 id="3.2 Compound Primary Key">3.2 Compound Primary Key</h2>
In Cassandra, a compound primary key consists of more than one column and treats only one column as the partition key. The other columns are treated as clustering columns.
To define a compound primary key on a domain class, each property that is part of the key has to be defined in the mapping block with a <code>primaryKey</code> map. Example:<p class="paragraph"/><div class="code"><pre>class Person  &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> lastName
    <span class="java&#45;object">String</span> firstName    
    <span class="java&#45;object">Integer</span> age = 0
    <span class="java&#45;object">String</span> location<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        id name:<span class="java&#45;quote">"lastName"</span>, primaryKey:&#91;ordinal:0, type:<span class="java&#45;quote">"partitioned"</span>&#93;, generator:<span class="java&#45;quote">"assigned"</span>     
        firstName index:<span class="java&#45;keyword">true</span>, primaryKey:&#91;ordinal:1, type: <span class="java&#45;quote">"clustered"</span>&#93;   
        age primaryKey:&#91;ordinal:2, type: <span class="java&#45;quote">"clustered"</span>&#93;     
        version <span class="java&#45;keyword">false</span>  
    &#125;
&#125;</pre></div><p class="paragraph"/>The above mapping will generate the following Cassandra table if schema creation is on:<p class="paragraph"/><div class="code"><pre>CREATE TABLE person (lastname text, firstname text, age <span class="java&#45;object">int</span>, location text, PRIMARY KEY (lastname, firstname, age))</pre></div><p class="paragraph"/><h4>Composite Partition Key</h4>
A composite partition key consists of multiple columns and treats more than one column as the partition key. The other columns are treated as clustering columns.
To define a composite partition key on a domain class, each property that is a part of the key has to have its <code>primaryKey type</code> attribute set to "partitioned". Example:
<div class="code"><pre>class Person  &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> lastName
    <span class="java&#45;object">String</span> firstName    
    <span class="java&#45;object">Integer</span> age = 0
    <span class="java&#45;object">String</span> location<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        id name:<span class="java&#45;quote">"lastName"</span>, primaryKey:&#91;ordinal:0, type:<span class="java&#45;quote">"partitioned"</span>&#93;, generator:<span class="java&#45;quote">"assigned"</span>     
        firstName index:<span class="java&#45;keyword">true</span>, primaryKey:&#91;ordinal:1, type: <span class="java&#45;quote">"partitioned"</span>&#93;   
        age index:<span class="java&#45;keyword">true</span>, primaryKey:&#91;ordinal:0, type: <span class="java&#45;quote">"clustered"</span>&#93;     
        version <span class="java&#45;keyword">false</span>  
    &#125;
&#125;
&#8230;
CREATE TABLE person (lastname text, firstname text, age <span class="java&#45;object">int</span>, location text, PRIMARY KEY ((lastname, firstname), age))</pre></div><p class="paragraph"/><h4>The mapping block</h4>
The first column of the partition key is always mapped using <code>id</code>, and then the name of the actual property.<p class="paragraph"/>
You should then add the <code>primaryKey</code> map to all columns of the compound/composite primary key. The two attributes are: 
<ul class="star">
<li><code>ordinal</code> - specifies the order of the column in the compound/composite primary key.</li>
<li><code>type</code> - "partitioned" or "clustered". For a compound primary key only one property is type "partitioned" and the rest are type "clustered". For a composite partition key more than one property is type "partitioned".</li>
</ul><p class="paragraph"/><h4>Persistence and Querying for Compound/Composite Primary Key domain classes</h4>
Where ever you need to pass in an id to a persistence or query method, pass in a map containing the components of the compound/composite primary key instead.<p class="paragraph"/>Example:<p class="paragraph"/><div class="code"><pre>def person = Person.get(&#91;firstName:<span class="java&#45;quote">"Bob"</span>, lastName: <span class="java&#45;quote">"Wilson"</span>, age: 25&#93;)
Person.updateProperties(&#91;firstName:<span class="java&#45;quote">"Bob"</span>, lastName: <span class="java&#45;quote">"Wilson"</span>, age: 25&#93;, &#91;location: <span class="java&#45;quote">"London"</span>&#93;, &#91;flush:<span class="java&#45;keyword">true</span>&#93;)</pre></div>



<h2 id="3.2 Indexing Queries">3.3 Indexing Queries</h2>
<h4>Basics</h4><p class="paragraph"/>Cassandra doesn't require that you specify indices to query. Cassandra supports creating an index on most columns, including a clustering column of a compound primary key or on the partition (primary) key itself.
Indexing can impact performance greatly. Before creating an index, be aware of when and <a href="http://www.datastax.com/documentation/cql/3.1/cql/ddl/ddl_when_use_index_c.html#concept_ds_sgh_yzz_zj__when-no-index" target="blank">when not to create an index</a>.<p class="paragraph"/>With that in mind it is important to specify the properties you plan to query using the mapping block:<p class="paragraph"/><div class="code"><pre>class Person &#123;
    <span class="java&#45;object">String</span> name
    <span class="java&#45;keyword">static</span> mapping = &#123;
        name index:<span class="java&#45;keyword">true</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>The above mapping will generate the following Cassandra index if schema creation is on:<p class="paragraph"/><div class="code"><pre>CREATE INDEX IF NOT EXISTS  ON person (name)</pre></div>



<h2 id="3.3 Table Properties">3.4 Table Properties</h2>
You can configure clustering order, caching, compaction, and a number of other operations that Cassandra performs on a new table.<p class="paragraph"/><h4>Clusterting order</h4>
An explanation is provided in the <a href="http://www.datastax.com/documentation/cql/3.1/cql/cql_reference/refClstrOrdr.html" target="blank">Cassandra docs</a>.
Clustering order can only be used on a clustered primary key, to use it set its order attribute. Example:<p class="paragraph"/><div class="code"><pre>class Person &#123;
    ..
    <span class="java&#45;keyword">static</span> mapping = &#123;
        id name:<span class="java&#45;quote">"lastName"</span>, primaryKey:&#91;ordinal:0, type:<span class="java&#45;quote">"partitioned"</span>&#93;, generator:<span class="java&#45;quote">"assigned"</span>
        firstName index:<span class="java&#45;keyword">true</span>, primaryKey:&#91;ordinal:1, type: <span class="java&#45;quote">"clustered"</span>&#93;, order: <span class="java&#45;quote">"desc"</span> //or order: <span class="java&#45;quote">"asc"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><h4>Setting a table property</h4>
Available properties and their descriptions are defined in the <a href="http://www.datastax.com/documentation/cql/3.1/cql/cql_reference/tabProp.html" target="blank">Cassandra docs</a>.
If you want to set a table property, define a static <code>tableProperties</code> block. 
Below is an example of the properties you can set with Cassandra GORM:<p class="paragraph"/><div class="code"><pre>class Person &#123;
    ..	
    <span class="java&#45;keyword">static</span> mapping = &#123;
        id name:<span class="java&#45;quote">"lastName"</span>, primaryKey:&#91;ordinal:0, type:<span class="java&#45;quote">"partitioned"</span>&#93;
        firstName primaryKey:&#91;ordinal:1, type: <span class="java&#45;quote">"clustered"</span>&#93;, order:<span class="java&#45;quote">"desc"</span>
    &#125;<p class="paragraph"/>    <span class="java&#45;keyword">static</span> tableProperties = &#123;
        comment <span class="java&#45;quote">"table comment"</span>
        <span class="java&#45;quote">"COMPACT STORAGE"</span> <span class="java&#45;keyword">true</span> //OR <span class="java&#45;quote">"compact_storage"</span> <span class="java&#45;keyword">true</span>
        replicate_on_write <span class="java&#45;keyword">false</span>
        caching <span class="java&#45;quote">"all"</span>
        bloom_filter_fp_chance 0.2
        read_repair_chance 0.1
        dclocal_read_repair_chance 0.2
        gc_grace_seconds 900000
        compaction class: <span class="java&#45;quote">"SizeTieredCompactionStrategy"</span>, bucket_high: 2.5, bucket_low: 0.6, max_threshold: 40, min_threshold: 5, min_sstable_size: 60
        compression sstable_compression: <span class="java&#45;quote">"LZ4Compressor"</span>, chunk_length_kb: 128,	crc_check_chance: 0.85	
    &#125;
&#125;</pre></div>
The above mapping will generate the following Cassandra table if schema creation is on:<p class="paragraph"/><div class="code"><pre>CREATE TABLE person (lastname text, firstname text, version bigint, PRIMARY KEY (lastname, firstname)) 
WITH CLUSTERING ORDER BY (firstname DESC) AND comment = 'table comment' AND COMPACT STORAGE AND replicate_on_write = '<span class="java&#45;keyword">false</span>' 
AND caching = 'all' AND bloom_filter_fp_chance = 0.2 AND read_repair_chance = 0.1 AND dclocal_read_repair_chance = 0.2 
AND gc_grace_seconds = 900000 
AND compaction = &#123; 'class' : 'SizeTieredCompactionStrategy', 'bucket_high' : 2.5, 'bucket_low' : 0.6, 'max_threshold' : 40, 'min_threshold' : 5, 
                   'min_sstable_size' : 60 &#125; 
AND compression = &#123; 'sstable_compression' : 'LZ4Compressor', 'chunk_length_kb' : 128, 'crc_check_chance' : 0.85 &#125;;</pre></div><p class="paragraph"/><h4><a href="http://www.datastax.com/documentation/cql/3.1/cql/cql_reference/tabProp.html" target="blank">Table property options</a></h4>
<ul class="star">
<li>comment : String</li>
<li>"COMPACT STORAGE" OR "compact_storage" : boolean</li>
<li>replicate_on_write : boolean</li>
<li>caching : "all", "keys_only", "rows_only", "none"</li>
<li>bloom_filter_fp_chance : double</li>
<li>read_repair_chance : double</li>
<li>dclocal_read_repair_chance : double</li>
<li>gc_grace_seconds : long</li>
<li>compaction : class, tombstone_threshold, tombstone_compaction_interval, min_sstable_size, min_threshold, max_threshold, bucket_low, bucket_high, sstable_size_in_mb</li>
<li>compression : sstable_compression, chunk_length_kb, crc_check_chance</li>
</ul><p class="paragraph"/>


<h2 id="3.4 Stateful vs. Stateless Domain Classes">3.5 Stateful vs. Stateless Domain Classes</h2>
GORM for Cassandra supports both stateless and stateful modes for mapping domain classes to Cassandra. In general stateful mapping is superior for write heavy applications and stateless mode better for read heavy applications (particularily when large amounts of data is involved).<p class="paragraph"/><h4>Stateful mode</h4><p class="paragraph"/>Domain classes are by default stateful, which means when they are read from Cassandra their state is stored in the user session (which is typically bound to the request in Grails). This has several advantages for write heavy applications:
<ul class="star">
<li>GORM can automatically detect whether a call to save() is a an update or an insert and act appropriately</li>
<li>GORM can store the current version and therefore implement optimistic locking</li>
<li>Repeated reads of the same entity can be retrieved from the cache, thus optimizing reads as well</li>
</ul><p class="paragraph"/>An example of when a stateful domain class is better is batching (TO BE IMPLEMENTED)<p class="paragraph"/><h4>Stateless Domain classes</h4><p class="paragraph"/>However, stateful domain classes can cause problems for read-heavy applications. Take for example the following code:<p class="paragraph"/><div class="code"><pre>def books = Book.list() // read 100,000 books
<span class="java&#45;keyword">for</span>(b in books) &#123;
    println b.title
&#125;</pre></div><p class="paragraph"/>The above example will read 100,000 books and print the title of each. In stateful mode this will almost certainly run out of memory as each Cassandra row is stored in user memory as is each book. Rewriting the code as follows will solve the problem:<p class="paragraph"/><div class="code"><pre>Book.withStatelessSession &#123;
    def books = Book.list() // read 100,000 books
    <span class="java&#45;keyword">for</span>(b in books) &#123;
        println b.title
    &#125;    
&#125;</pre></div><p class="paragraph"/>Alternatively you can map the domain class as stateless, in which case its state will never be stored in the session:<p class="paragraph"/><div class="code"><pre>class Book &#123;
    &#8230;
    <span class="java&#45;keyword">static</span> mapping = &#123;
        stateless <span class="java&#45;keyword">true</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><h4>Disadvantages of Stateless Mode</h4><p class="paragraph"/>There are several disadvantages to using stateless domain classes as the default. One disadvantage is that if you are using assigned identifiers GORM cannot detect whether you want to do an insert or an update so you have to be explicit about which one you want:<p class="paragraph"/><div class="code"><pre>def b = <span class="java&#45;keyword">new</span> Book(id:<span class="java&#45;quote">"The Book"</span>)
b.insert()
b.revenue = 100
b.update()</pre></div><p class="paragraph"/>In the above case we use the explicit 'insert' or 'update method to tell Cassandra GORM what to do.


<h1 id="4. Querying and Persistence Options">4 Querying and Persistence Options</h1>
The GORM for Cassandra plugin supports passing various options to Cassandra when querying or persisting.<p class="paragraph"/>



<h2 id="4.1 Querying Options">4.1 Querying Options</h2>
<h4>Limiting results</h4>
Using the <code>max</code> parameter, you can specify that the query return a limited number of rows. Example:
<div class="code"><pre>def people = Person.list(max:2)</pre></div><p class="paragraph"/>Note that Cassandra does not support the <code>offset</code> parameter, so you cannot page results this way.<p class="paragraph"/><h4>Fetch Size</h4>
Setting the <a href="http://www.datastax.com/documentation/developer/java-driver/2.0/java-driver/reference/queryBuilderOverview.html?scroll=queryBuilderOverview__setting-query-options-querybuilder-api" target="blank">fetch size</a>, or number of rows returned simultaneously by a select query, is typically needed when queries return extremely large numbers of rows. 
To do this you can use the <code>fetchSize</code> argument:<p class="paragraph"/><div class="code"><pre>def people = Person.list(&#91;fetchSize: 200&#93;)
people = Person.findAllByFirstName(<span class="java&#45;quote">"Barney"</span>, &#91;fetchSize: 200&#93;)</pre></div><p class="paragraph"/>Setting the fetch size to small values is discouraged as it will yield very poor performance.<p class="paragraph"/>In some cases you may want or have to disable paging entirely, for example when using order by and IN, in which case set the <code>fetchSize</code> to Integer.MAX_VALUE. Example:<p class="paragraph"/><div class="code"><pre>People.createCriteria().list &#123;
    'in' <span class="java&#45;quote">"lastName"</span>, &#91;<span class="java&#45;quote">"Flintstone"</span>, <span class="java&#45;quote">"Rubble"</span>&#93;
    order <span class="java&#45;quote">"name"</span>
    fetchSize <span class="java&#45;object">Integer</span>.MAX_VALUE
&#125;</pre></div><p class="paragraph"/><h4>Allow filtering</h4>
When you attempt a potentially expensive query Cassandra may throw an exception mentioning <a href="http://www.datastax.com/documentation/cql/3.1/cql/cql_reference/select_r.html?scroll=reference_ds_d35_v2q_xj__selAllFltr" target="blank">ALLOW FILTERING</a>.
To run the query, you can use the <code>allowFiltering</code> argument which is passed onto Cassandra. Imposing a limit using the <code>max</code> parameter is recommended to reduce memory used.<p class="paragraph"/>Example:
<div class="code"><pre>def people = Person.findAllByFirstNameAndAgeLessThanEquals('Barney', 35, &#91;allowFiltering:<span class="java&#45;keyword">true</span>, max:5&#93;)
def person = Person.findOrSaveWhere(firstName: 'Rubble', age: 35, &#91;allowFiltering:<span class="java&#45;keyword">true</span>, flush:<span class="java&#45;keyword">true</span>&#93;)
def criteria = Person.createCriteria()  
people = criteria.list (allowFiltering:<span class="java&#45;keyword">true</span>, max:5) &#123;
            and &#123;
                eq('firstName', 'Fred')
                eq('age', 40)
            &#125;
         &#125;  
people = criteria.list &#123;
            projections &#123;
                eq('firstName', 'Bob')
                between(<span class="java&#45;quote">"age"</span>, 40, 43)                   
            &#125;
            allowFiltering <span class="java&#45;keyword">true</span>
            max 5    
         &#125;</pre></div>


<h1 id="5. Low-level API">5 Low-level API</h1>
A lower level API is provided by the plugin that is based on the <a href="http://projects.spring.io/spring-data-cassandra/" target="blank">Spring Data Cassandra</a> project.<p class="paragraph"/>Spring Data Cassandra provides a <a href="http://docs.spring.io/spring-data/cassandra/docs/1.0.4.RELEASE/api/org/springframework/data/cassandra/core/CassandraTemplate.html" target="blank">CassandraTemplate</a> with methods to execute statements using the regular <a href="http://www.datastax.com/documentation/developer/java-driver/2.0/common/drivers/introduction/introArchOverview_c.html" target="blank">Cassandra Java Driver</a><p class="paragraph"/>To get hold of the <code>cassandraTemplate</code> instance inside a controller or service simply define a <code>cassandraTemplate</code> property. An example can be seen below:<p class="paragraph"/><div class="code"><pre>def cassandraTemplate<p class="paragraph"/>def myAction = &#123;
	def people = &#91;&#93;
	people &#60;&#60; <span class="java&#45;keyword">new</span> Person(firstName: <span class="java&#45;quote">"Fred"</span>, lastName: <span class="java&#45;quote">"Flintstone"</span>)
	people &#60;&#60; <span class="java&#45;keyword">new</span> Person(firstName: <span class="java&#45;quote">"Barney"</span>, lastName: <span class="java&#45;quote">"Rubble"</span>)
	cassandraTemplate.insert(people)
&#125;</pre></div><p class="paragraph"/>You can also create a CQL or Java Driver statement and execute it using cassandraTemplate<p class="paragraph"/><div class="code"><pre>Select personSelect = QueryBuilder.select().all().from(<span class="java&#45;quote">"person"</span>)
List personList = cassandraTemplate.select(personSelect, Person.class)<p class="paragraph"/><span class="java&#45;object">String</span> personCQL = <span class="java&#45;quote">"SELECT firstName FROM person"</span>
List personList = cassandraTemplate.select(personCQL, Person.class)</pre></div>

                    </div>
                </td>
                <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Beans</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../ref/Beans/cassandraTemplate.html">cassandraTemplate</a>
                        </div>
                        
                        </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Domain Classes</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/appendTo.html">appendTo</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/deleteAtFrom.html">deleteAtFrom</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/deleteFrom.html">deleteFrom</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/prependTo.html">prependTo</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/replaceAtIn.html">replaceAtIn</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/updateProperties.html">updateProperties</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/updateProperty.html">updateProperty</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/updateSingleTypes.html">updateSingleTypes</a>
                        </div>
                        
                        </div>
                    </div>
                    
                </div>
            </div>
        </td>
            </tr>
        </table>

        <div id="footer">
            
            
        </div>



<script type="text/javascript" src="../js/docs.js"></script>

    </body>
</html>

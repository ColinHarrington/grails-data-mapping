<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
    <head>
        <title>GORM for MongoDB 5.0.0.BUILD-SNAPSHOT</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
        <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />
    <script type="text/javascript">
function addJsClass(el) {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
    </head>

    <body class="body" onload="addJsClass();">
        <div id="navigation">
            <ul>
                <li>
                    <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                        <a href="../guide/index.html" class="button">Table of contents</a>
                        <div id="nav-summary-childs" style="display:none;">
                            
                            <div class="toc-item" style="margin-left:0"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#gettingStarted"><strong>2</strong><span>Getting Started</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#objectMapping"><strong>3</strong><span>Mapping Domain Classes to MongoDB Collections</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#databaseSwitching"><strong>4</strong><span>Switching Database or Collection at Runtime</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#stateless"><strong>5</strong><span>Stateless Mode</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#lowLevelApi"><strong>6</strong><span>Using the Mongo Driver Directly</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#transactions"><strong>7</strong><span>Transactions</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#testing"><strong>8</strong><span>Unit Testing</span></a></div>
                            
                        </div>
                    </div>
                </li>
                <li class="separator selected">
                    <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
                </li>
            </ul>
        </div>
        <div id="header">
            <div class="images clearfix">
                
                
            </div>
            <p></p>
        </div>


        <table id="colset" border="0" cellpadding="0" cellspacing="0">
            <tr>
                <td id="col1">
                    <div id="main" class="corner-all">

                        <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                        <div class="project">
                            <h1>GORM for MongoDB - Reference Documentation</h1>
                            <p><strong>Authors:</strong> Graeme Rocher, Burt Beckwith</p>
                            <p><strong>Version:</strong> 5.0.0.BUILD-SNAPSHOT</p>
                            
                        </div>

                        
                        <div id="table-of-content">
                            <h2>Table of Contents</h2>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#compatibility"><strong>1.1</strong><span>Compatibility with GORM for Hibernate</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#releaseNotes"><strong>1.2</strong><span>Release Notes</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#upgradeNotes"><strong>1.3</strong><span>Upgrade Notes</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#gettingStarted"><strong>2</strong><span>Getting Started</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#mongoOnly"><strong>2.1</strong><span>Using MongoDB Standalone</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#withHibernate"><strong>2.2</strong><span>Combining MongoDB and Hibernate</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#advancedConfig"><strong>2.3</strong><span>Advanced Configuration</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#outsideGrails"><strong>2.4</strong><span>GORM for MongoDB without Grails</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#objectMapping"><strong>3</strong><span>Mapping Domain Classes to MongoDB Collections</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#idGeneration"><strong>3.1</strong><span>Identity Generation</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#queryIndexes"><strong>3.2</strong><span>Querying Indexing</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#writeConcern"><strong>3.3</strong><span>Customizing the WriteConcern</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#dynamicAttributes"><strong>3.4</strong><span>Dynamic Attributes</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#geoSpatial"><strong>3.5</strong><span>Geospacial Querying</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#2dsphere"><strong>3.5.1</strong><span>Geospacial 2D Sphere Support</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#2dindex"><strong>3.5.2</strong><span>Geospacial 2D Index Support</span></a></div>
                            
                            <div class="toc-item" style="margin-left:20px"><a href="#geoJson"><strong>3.5.3</strong><span>GeoJSON Data Models</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#textSearch"><strong>3.6</strong><span>Full Text Search</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#customTypes"><strong>3.7</strong><span>Custom User Types</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#databaseSwitching"><strong>4</strong><span>Switching Database or Collection at Runtime</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#stateless"><strong>5</strong><span>Stateless Mode</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#lowLevelApi"><strong>6</strong><span>Using the Mongo Driver Directly</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#transactions"><strong>7</strong><span>Transactions</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#testing"><strong>8</strong><span>Unit Testing</span></a></div>
                            
                            <div style="clear:both" ></div>
                        </div>
                        
                        

<h1 id="introduction">1 Introduction</h1>
MongoDB bridges the gap between key-value stores (which are fast and highly scalable) and traditional RDBMS systems (which provide rich queries and deep functionality).<p class="paragraph"/>MongoDB (from "humongous") is a scalable, high-performance, open source, document-oriented database.<p class="paragraph"/>This project aims to provide an object-mapping layer on top of Mongo to ease common activities such as:
<ul class="star">
<li>Marshalling from Mongo to Groovy/Java types and back again</li>
<li>Support for GORM dynamic finders, criteria and named queries</li>
<li>Session-managed transactions</li>
<li>Validating domain instances backed by the Mongo datastore</li>
</ul><p class="paragraph"/>


<h2 id="compatibility">1.1 Compatibility with GORM for Hibernate</h2>
This implementation tries to be as compatible as possible with GORM for Hibernate. In general you can refer to the <a href="http://grails.org/doc/latest/guide/5.%20Object%20Relational%20Mapping%20(GORM).html" target="blank">GORM documentation</a> and the "Domain Classes" section of the <a href="http://grails.org/doc/latest/" target="blank">reference guide</a> (see the right nav) for usage information.<p class="paragraph"/>The following key features are supported by GORM for Mongo:
<ul class="star">
<li>Simple persistence methods</li>
<li>Dynamic finders</li>
<li>Criteria queries</li>
<li>Named queries</li>
<li>Inheritance</li>
<li>Embedded types</li>
<li>Query by example</li>
</ul><p class="paragraph"/>However, some features are not supported:
<ul class="star">
<li>HQL queries</li>
<li>Composite primary keys</li>
<li>Many-to-many associations (these can be modelled with a mapping class)</li>
<li>Any direct interaction with the Hibernate API</li>
<li>Custom Hibernate user types (custom types are allowed with a different API)</li>
</ul><p class="paragraph"/>There may be other limitations not mentioned here so in general it shouldn't be expected that an application based on GORM for Hibernate will "just work" without some tweaking involved. Having said that, the large majority of common GORM functionality is supported.



<h2 id="releaseNotes">1.2 Release Notes</h2>
Below are the details of the changes across releases:<p class="paragraph"/><h4>5.0</h4>
<ul class="star">
<li>MongoDB 3.x driver support</li>
<li>New Codec Persistence Engine</li>
<li>Removal of GMongo</li>
<li>Trait based</li>
</ul><p class="paragraph"/><h4>4.0</h4>
<ul class="star">
<li>Grails 3 compatibility</li>
</ul><p class="paragraph"/><h4>3.0</h4>
<ul class="star">
<li>Support for MongoDB 2.6</li>
<li>MongoDB 2.6 GeoJSON type support (<code>MultiPoint</code>, <code>MultiLineString</code>, <code>MultiPolygon</code> and <code>GeometryCollection</code>)</li>
<li>Support for Maps of embedded entities</li>
<li>Flexible index definition</li>
<li>Full text search support</li>
<li>Support for projections using MongoDB aggregation</li>
<li>Size related criteria implemented (<code>sizeEq</code>, <code>sizeLt</code> etc.) on collections</li>
</ul><p class="paragraph"/><h4>2.0</h4>
<ul class="star">
<li>GeoJSON shape support</li>
<li>Support for SSL connections</li>
<li>Support for MongoDB connection strings</li>
</ul><p class="paragraph"/><h4>1.3</h4>
<ul class="star">
<li>Support for stateless mode to improve read performance</li>
<li>Support for dynamically switching which database or collection to persist to at runtime</li>
</ul><p class="paragraph"/><h4>1.2 </h4><p class="paragraph"/><blockquote class="warning">
MongoDB plugin 1.2 and above requires Grails 2.1.5 or 2.2.1 as a minimum Grails version, if you are using older versions of Grails you will need to stay with 1.1
</blockquote><p class="paragraph"/><h4>1.1 GA</h4>
<ul class="star">
<li>DBRefs no longer used by default for associations</li>
<li>Upgrade to GMongo 1.0 and Spring Data MongoDB 1.1</li>
<li>Support for global mapping configuration</li>
</ul><p class="paragraph"/><h4>1.0 GA</h4>
<ul class="star">
<li>Initial feature complete 1.0 release</li>
</ul><p class="paragraph"/>


<h2 id="upgradeNotes">1.3 Upgrade Notes</h2>
Since GORM for MongoDB 5.0 there is now a choice of persistence engine. The origin GORM for MongoDB converted MongoDB documents to and from Groovy objects. This engine is still present and can be activated with the following configuration in <code>grails-app/conf/application.yml</code>:<p class="paragraph"/><div class="code"><pre>grails:
    mongodb:
        engine: mapping</pre></div><p class="paragraph"/>However, 5.0 and above uses a new engine based on MongoDB 3.x driver codecs which means objects are no longer converted first to MongoDB Document objects and then to Groovy objects, instead the driver reads Groovy objects directly from the JSON stream at the driver level, which is far more efficient, however may not exhibit exactly the same behaviour as the previous version. To active this new engine use the following codec (or leave it blank as the codec engine is now the default):<p class="paragraph"/><div class="code"><pre>grails:
    mongodb:
        engine: codec</pre></div>


<h1 id="gettingStarted">2 Getting Started</h1>
To get started with GORM for Mongo you need configure it as a dependency in <code>build.gradle</code>:<p class="paragraph"/><div class="code"><pre>plugins &#123;
	compile 'org.grails.plugins:mongodb:VERSION'
&#125;</pre></div><p class="paragraph"/>With that done you need to set up a running MongoDB server. Refer to the <a href="https://docs.mongodb.org/manual/" target="blank">MongoDB Documentation</a> for an explanation on how to startup a Mongo instance. Once installed, starting Mongo is typically a matter of executing the following command:<p class="paragraph"/><div class="code"><pre>MONGO_HOME/bin/mongod</pre></div><p class="paragraph"/>With the above command executed in a terminal window you should see output like the following appear:<p class="paragraph"/><div class="code"><pre>2015&#45;11&#45;18T19:38:50.073+0100 I JOURNAL  &#91;initandlisten&#93; journal dir=/data/db/journal
2015&#45;11&#45;18T19:38:50.073+0100 I JOURNAL  &#91;initandlisten&#93; recover : no journal files present, no recovery needed
2015&#45;11&#45;18T19:38:50.090+0100 I JOURNAL  &#91;durability&#93; Durability thread started
2015&#45;11&#45;18T19:38:50.090+0100 I JOURNAL  &#91;journal writer&#93; Journal writer thread started
2015&#45;11&#45;18T19:38:50.090+0100 I CONTROL  &#91;initandlisten&#93; MongoDB starting : pid=52540 port=27017 dbpath=/data/db 64&#45;bit host=Graemes&#45;iMac.local
2015&#45;11&#45;18T19:38:50.090+0100 I CONTROL  &#91;initandlisten&#93; &#42;&#42; WARNING: You are running <span class="java&#45;keyword">this</span> process as the root user, which is not recommended.
2015&#45;11&#45;18T19:38:50.090+0100 I CONTROL  &#91;initandlisten&#93;
2015&#45;11&#45;18T19:38:50.090+0100 I CONTROL  &#91;initandlisten&#93;
2015&#45;11&#45;18T19:38:50.090+0100 I CONTROL  &#91;initandlisten&#93; &#42;&#42; WARNING: soft rlimits too low. <span class="java&#45;object">Number</span> of files is 256, should be at least 1000
2015&#45;11&#45;18T19:38:50.090+0100 I CONTROL  &#91;initandlisten&#93; db version v3.0.4
2015&#45;11&#45;18T19:38:50.090+0100 I CONTROL  &#91;initandlisten&#93; git version: 0481c958daeb2969800511e7475dc66986fa9ed5
2015&#45;11&#45;18T19:38:50.090+0100 I CONTROL  &#91;initandlisten&#93; build info: Darwin mci&#45;osx108&#45;11.build.10gen.cc 12.5.0 Darwin Kernel Version 12.5.0: Sun Sep 29 13:33:47 PDT 2013; root:xnu&#45;2050.48.12~1/RELEASE_X86_64 x86_64 BOOST_LIB_VERSION=1_49
2015&#45;11&#45;18T19:38:50.090+0100 I CONTROL  &#91;initandlisten&#93; allocator: system
2015&#45;11&#45;18T19:38:50.090+0100 I CONTROL  &#91;initandlisten&#93; options: &#123;&#125;
2015&#45;11&#45;18T19:38:50.176+0100 I NETWORK  &#91;initandlisten&#93; waiting <span class="java&#45;keyword">for</span> connections on port 27017</pre></div><p class="paragraph"/>As you can see the server is running on port 27017, but don't worry the Mongodb plugin for Grails will automatically configure itself to look for Mongodb on that port by default.<p class="paragraph"/>If you want to configure how Grails connects to Mongo then you can do so using the following settings in <code>grails-app/conf/application.yml</code>:<p class="paragraph"/><div class="code"><pre>grails:
    mongodb:
        host: <span class="java&#45;quote">"localhost"</span>
        port: 27017
        username: <span class="java&#45;quote">"blah"</span>
        password: <span class="java&#45;quote">"blah"</span>
        databaseName: <span class="java&#45;quote">"foo"</span></pre></div>



<h2 id="mongoOnly">2.1 Using MongoDB Standalone</h2>
If you plan to use MongoDB as your primary datastore then you need to remove the Hibernate plugin from the <code>build.gradle</code> file by commenting out the hibernate line in the plugins block<p class="paragraph"/><div class="code"><pre>compile 'org.grails.plugins:hibernate'</pre></div><p class="paragraph"/>With this done all domain classes in grails-app/domain will be persisted via MongoDB and not Hibernate. You can create a domain class by running the regular <code>create-domain-class</code> command:<p class="paragraph"/><div class="code"><pre>grails create&#45;domain&#45;class Person</pre></div><p class="paragraph"/>The <code>Person</code> domain class will automatically be a persistent entity that can be stored in MongoDB.



<h2 id="withHibernate">2.2 Combining MongoDB and Hibernate</h2>
If you have both the Hibernate and Mongo plugins installed then by default all classes in the <code>grails-app/domain</code> directory will be persisted by Hibernate and not Mongo. If you want to persist a particular domain class with Mongo then you must use the <code>mapWith</code> property in the domain class:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> mapWith = <span class="java&#45;quote">"mongo"</span></pre></div><p class="paragraph"/>



<h2 id="advancedConfig">2.3 Advanced Configuration</h2>
<h4>Mongo Database Connection Configuration</h4><p class="paragraph"/>As mentioned the GORM for Mongo plugin will configure all the defaults for you, but if you wish to customize those defaults you can do so in the <code>grails-app/conf/application.groovy</code> file:<p class="paragraph"/><div class="code"><pre>grails &#123;
    mongo &#123;
        host = <span class="java&#45;quote">"localhost"</span>
        port = 27017
        username = <span class="java&#45;quote">"blah"</span>
        password = <span class="java&#45;quote">"blah"</span>
        databaseName = <span class="java&#45;quote">"foo"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>The <code>databaseName</code> setting configures the default database name. If not specified the <code>databaseName</code> will default to the name of your application.<p class="paragraph"/>You can also customize the Mongo connection settings using an <code>options</code> block:<p class="paragraph"/><div class="code"><pre>grails &#123;
    mongo &#123;
        options &#123;
            autoConnectRetry = <span class="java&#45;keyword">true</span>
            connectTimeout = 300
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/>Available options and their descriptions are defined in the <a href="http://api.mongodb.org/java/current/com/mongodb/MongoClientOptions.html" target="blank">MongoOptions</a> javadoc.<p class="paragraph"/>In production scenarios you will typically use more than one MongoDB server in either <a href="http://docs.mongodb.org/manual/core/master-slave/" target="blank">master/slave</a> or <a href="http://docs.mongodb.org/manual/replication/" target="blank">replication</a> scenarios. The plugin allows you to configure <a href="http://docs.mongodb.org/manual/tutorial/deploy-replica-set/" target="blank">replica sets</a>:<p class="paragraph"/><div class="code"><pre>grails &#123;
    mongo &#123;
        replicaSet = &#91; <span class="java&#45;quote">"localhost:27017"</span>, <span class="java&#45;quote">"localhost:27018"</span>&#93;
    &#125;
&#125;</pre></div><p class="paragraph"/>The replica sets are defined using a list of strings that conform to the MongoDB <a href="http://api.mongodb.org/java/current/com/mongodb/DBAddress.html" target="blank">DBAddress</a> specification.<p class="paragraph"/><h4>MongoDB Connection Strings</h4><p class="paragraph"/>Since 2.0, you can also use MongoDB <a href="http://docs.mongodb.org/manual/reference/connection-string/" target="blank">connection strings</a> to configure the connection:<p class="paragraph"/><div class="code"><pre>grails &#123;
    mongo &#123;
        connectionString = <span class="java&#45;quote">"mongodb://localhost/mydb"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>Using MongoDB connection strings is currently the most flexible and recommended way to configure MongoDB connections.<p class="paragraph"/><h4>SSL Connections</h4><p class="paragraph"/>You can configure SSL connections by setting <code>ssl</code> to true in the <code>options</code> block:<p class="paragraph"/><div class="code"><pre>grails &#123;
    mongo &#123;
        &#8230;
        options &#123;
            ssl = <span class="java&#45;keyword">true</span>
            &#8230;
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/><blockquote class="note">
Note you can also configure the <code>SSLSocketFactory</code> manually if necessary. All settings within the <code>options</code> block are propagated to the underlying <a href="http://docs.spring.io/spring-data/mongodb/docs/1.4.0.RELEASE/api/org/springframework/data/mongodb/core/MongoOptionsFactoryBean.html" target="blank">MongoOptionsFactoryBean</a>
</blockquote><p class="paragraph"/><h4>Configuration Options Guide</h4><p class="paragraph"/>Below is a complete example showing all configuration options:<p class="paragraph"/><div class="code"><pre>grails &#123;
    mongo &#123;
        databaseName = <span class="java&#45;quote">"myDb"</span> // the <span class="java&#45;keyword">default</span> database name
        host <span class="java&#45;quote">"localhost"</span> // the host to connect to
        port = 27017 // the port to connect to
        username = <span class="java&#45;quote">".."</span> // the username to connect with
        password = <span class="java&#45;quote">".."</span> // the password to connect with
        stateless = <span class="java&#45;keyword">false</span> // whether to use stateless sessions by <span class="java&#45;keyword">default</span><p class="paragraph"/>        // Alternatively, using 'replicaSet' or 'connectionString'
        // replicaSet = &#91; <span class="java&#45;quote">"localhost:27017"</span>, <span class="java&#45;quote">"localhost:27018"</span>&#93;
        // connectionString = <span class="java&#45;quote">"mongodb://localhost/mydb"</span><p class="paragraph"/>        options &#123;
            connectionsPerHost = 10 // The maximum number of connections allowed per host
            threadsAllowedToBlockForConnectionMultiplier = 5
            maxWaitTime = 120000 // Max wait time of a blocking thread <span class="java&#45;keyword">for</span> a connection.
            connectTimeout = 0 // The connect timeout in milliseconds. 0 == infinite
            socketTimeout = 0 // The socket timeout. 0 == infinite
            socketKeepAlive = <span class="java&#45;keyword">false</span> // Whether or not to have socket keep alive turned on
            writeNumber = 0 // This specifies the number of servers to wait <span class="java&#45;keyword">for</span> on the write operation
            writeTimeout = 0 // The timeout <span class="java&#45;keyword">for</span> write operations in milliseconds
            writeFsync = <span class="java&#45;keyword">false</span> // Whether or not to fsync
            autoConnectRetry = <span class="java&#45;keyword">false</span> // Whether or not the system retries automatically on a failed connect
            maxAutoConnectRetryTime = 0 // The maximum amount of time in millisecons to spend retrying
            slaveOk = <span class="java&#45;keyword">false</span> // Specifies <span class="java&#45;keyword">if</span> the driver is allowed to read from secondaries or slaves
            ssl = <span class="java&#45;keyword">false</span> // Specifies <span class="java&#45;keyword">if</span> the driver should use an SSL connection to Mongo
            sslSocketFactory = &#8230; // Specifies the SSLSocketFactory to use <span class="java&#45;keyword">for</span> creating SSL connections
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/>
<h4>Global Mapping Configuration</h4><p class="paragraph"/>Using the <code>grails.mongo.default.mapping</code> setting in <code>grails-app/conf/application.groovy</code> you can configure global mapping options across your domain classes. This is useful if, for example, you want to disable optimistic locking globally or you wish to use <code>DBRefs</code> in your association mappings. For example, the following configuration will disable optimistic locking globally and use <code>DBRefs</code> for all properties:<p class="paragraph"/><div class="code"><pre>grails.mongo.<span class="java&#45;keyword">default</span>.mapping = &#123;
    version <span class="java&#45;keyword">false</span>
    '&#42;'(reference:<span class="java&#45;keyword">true</span>)
&#125;</pre></div><p class="paragraph"/>The <code>*</code> method is used to indicate that the setting applies to all properties.



<h2 id="outsideGrails">2.4 GORM for MongoDB without Grails</h2>
If you wish to use GORM for MongoDB outside of a Grails application you should declare the necessary dependencies, for example in Gradle:<p class="paragraph"/><div class="code"><pre>compile <span class="java&#45;quote">"org.grails:grails&#45;datastore&#45;gorm&#45;mongodb:VERSION"</span></pre></div><p class="paragraph"/>Then annotate your entities with the <code>grails.gorm.annotation.Entity</code> annotation:<p class="paragraph"/><div class="code"><pre>@Entity
class Person &#123;
    <span class="java&#45;object">String</span> name
&#125;</pre></div><p class="paragraph"/>Then you need to place the bootstrap logic somewhere in your application which uses <code>MongoDbDataStoreSpringInitializer</code>:<p class="paragraph"/><div class="code"><pre>def initializer = <span class="java&#45;keyword">new</span> MongoDbDataStoreSpringInitializer(Person)
def applicationContext = initializer.configure()<p class="paragraph"/>println Person.count()</pre></div><p class="paragraph"/>For configuration you can either pass a map or an instance of the <code>org.springframework.core.env.PropertyResolver</code> interface:<p class="paragraph"/><div class="code"><pre>def initializer = <span class="java&#45;keyword">new</span> MongoDbDataStoreSpringInitializer(&#91;'grails.mongodb.url':'http://myserver'&#93;, Person)
def applicationContext = initializer.configure()<p class="paragraph"/>println Person.count()</pre></div><p class="paragraph"/>If you are using Spring with an existing <code>ApplicationContext</code> you can instead call <code>configureForBeanDefinitionRegistry</code> prior to refreshing the context. You can pass the Spring <code>Environment</code> object to the constructor for configuration:<p class="paragraph"/><div class="code"><pre>ApplicationContext myApplicationContext = &#8230;
def initializer = <span class="java&#45;keyword">new</span> MongoDbDataStoreSpringInitializer(myApplicationContext.getEnvironment(), Person)
initializer.configureForBeanDefinitionRegistry(myApplicationContext)<p class="paragraph"/>println Person.count()</pre></div>


<h1 id="objectMapping">3 Mapping Domain Classes to MongoDB Collections</h1>
<h4>Basic Mapping</h4><p class="paragraph"/>The way GORM for Mongo works is to map each domain class to a Mongo collection. For example given a domain class such as:<p class="paragraph"/><div class="code"><pre>class Person &#123;
    <span class="java&#45;object">String</span> firstName
    <span class="java&#45;object">String</span> lastName
    <span class="java&#45;keyword">static</span> hasMany = &#91;pets:Pet&#93;
&#125;</pre></div><p class="paragraph"/>This will map onto a Mongo <a href="http://api.mongodb.org/java/current/com/mongodb/DBCollection.html" target="blank">DBCollection</a> called "person".<p class="paragraph"/><h4>Embedded Documents</h4><p class="paragraph"/>It is quite common in Mongo to embed documents within documents (nested documents). This can be done with GORM embedded types:<p class="paragraph"/><div class="code"><pre>class Person &#123;
    <span class="java&#45;object">String</span> firstName
    <span class="java&#45;object">String</span> lastName
    Address address
    <span class="java&#45;keyword">static</span> embedded = &#91;'address'&#93;
&#125;</pre></div><p class="paragraph"/>You can map embedded lists and sets of documents/domain classes:<p class="paragraph"/><div class="code"><pre>class Person &#123;
    <span class="java&#45;object">String</span> firstName
    <span class="java&#45;object">String</span> lastName
    Address address
    List otherAddresses
    <span class="java&#45;keyword">static</span> embedded = &#91;'address', 'otherAddresses'&#93;
&#125;</pre></div><p class="paragraph"/>You can also embed maps of embedded classes where the keys are strings:<p class="paragraph"/><div class="code"><pre>class Person &#123;
    <span class="java&#45;object">String</span> firstName
    <span class="java&#45;object">String</span> lastName
    Map&#60;<span class="java&#45;object">String</span>,Address&#62; addresses
    <span class="java&#45;keyword">static</span> embedded = &#91;'addresses'&#93;
&#125;</pre></div><p class="paragraph"/>
<h4>Basic Collection Types</h4><p class="paragraph"/>You can also map lists and maps of basic types (such as strings) simply by defining the appropriate collection type:<p class="paragraph"/><div class="code"><pre>class Person &#123;
    List&#60;<span class="java&#45;object">String</span>&#62; friends
    Map pets
&#125;<p class="paragraph"/>...<p class="paragraph"/><span class="java&#45;keyword">new</span> Person(friends:&#91;'Fred', 'Bob'&#93;, pets:&#91;chuck:<span class="java&#45;quote">"Dog"</span>, eddie:'Parrot'&#93;).save(flush:<span class="java&#45;keyword">true</span>)</pre></div><p class="paragraph"/>Basic collection types are stored as native ArrayList and BSON documents within the Mongo documents.<p class="paragraph"/><h4>Customized Collection and Database Mapping</h4><p class="paragraph"/>You may wish to customize how a domain class maps onto a <code>DBCollection</code>. This is possible using the <code>mapping</code> block as follows:<p class="paragraph"/><div class="code"><pre>class Person &#123;
    ..
    <span class="java&#45;keyword">static</span> mapping = &#123;
        collection <span class="java&#45;quote">"mycollection"</span>
        database <span class="java&#45;quote">"mydb"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>In this example we see that the <code>Person</code> entity has been mapped to a collection called "mycollection" in a database called "mydb".<p class="paragraph"/>You can also control how an individual property maps onto a Mongo Document field (the default is to use the property name itself):<p class="paragraph"/><div class="code"><pre>class Person &#123;
    ..
    <span class="java&#45;keyword">static</span> mapping = &#123;
        firstName attr:<span class="java&#45;quote">"first_name"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>For non-embedded associations by default GORM for MongoDB will map links between documents using MongoDB <a href="http://docs.mongodb.org/manual/reference/database-references/" target="blank">database references</a> also known as <code>DBRefs</code>.<p class="paragraph"/>If you prefer not to use DBRefs then you tell GORM to use direct links by using the <code>reference:false</code> mapping:<p class="paragraph"/><div class="code"><pre>class Person &#123;
    ..
    <span class="java&#45;keyword">static</span> mapping = &#123;
        address reference:<span class="java&#45;keyword">false</span>
    &#125;
&#125;</pre></div>



<h2 id="idGeneration">3.1 Identity Generation</h2>
By default in GORM entities are supplied with an integer-based identifier. So for example the following entity:<p class="paragraph"/><div class="code"><pre>class Person &#123;&#125;</pre></div><p class="paragraph"/>Has a property called <code>id</code> of type <code>java.lang.Long</code>. In this case GORM for Mongo will generate a sequence based identifier using the technique <a href="http://docs.mongodb.org/manual/tutorial/isolate-sequence-of-operations/" target="blank">described in the Mongo documentation</a> on Atomic operations.<p class="paragraph"/>However, sequence based integer identifiers are not ideal for environments that require <a href="http://docs.mongodb.org/manual/sharding/" target="blank">sharding</a> (one of the nicer features of Mongo). Hence it is generally advised to use either String based ids:<p class="paragraph"/><div class="code"><pre>class Person &#123;
    <span class="java&#45;object">String</span> id
&#125;</pre></div><p class="paragraph"/>Or a native BSON <a href="http://api.mongodb.org/java/current/org/bson/types/ObjectId.html" target="blank">ObjectId</a>:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> org.bson.types.ObjectId<p class="paragraph"/>class Person &#123;
    ObjectId id
&#125;</pre></div><p class="paragraph"/>BSON <code>ObjectId</code> instances are generated in a similar fashion to <code>UUIDs</code>.<p class="paragraph"/><h4>Assigned Identifiers</h4><p class="paragraph"/>Note that if you manually assign an identifier, then you will need to use the <code>insert</code> method instead of the <code>save</code> method, otherwise GORM can't work out whether you are trying to achieve an insert or an update. Example:<p class="paragraph"/><div class="code"><pre>class Person &#123;
    <span class="java&#45;object">String</span> id
&#125;
&#8230;
def p = <span class="java&#45;keyword">new</span> Person(id:<span class="java&#45;quote">"Fred"</span>)
// to insert
p.insert()
// to update
p.save()</pre></div>


<h2 id="queryIndexes">3.2 Querying Indexing</h2>
<h4>Basics</h4><p class="paragraph"/>MongoDB doesn't require that you specify indices to query, but like a relational database without specifying indices your queries will be significantly slower.<p class="paragraph"/>With that in mind it is important to specify the properties you plan to query using the mapping block:<p class="paragraph"/><div class="code"><pre>class Person &#123;
    <span class="java&#45;object">String</span> name
    <span class="java&#45;keyword">static</span> mapping = &#123;
        name index:<span class="java&#45;keyword">true</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>With the above mapping a MongoDB index will be automatically created for you. You can customize the index options using the <code>indexAttributes</code> configuration parameter:<p class="paragraph"/><div class="code"><pre>class Person &#123;
    <span class="java&#45;object">String</span> name
    <span class="java&#45;keyword">static</span> mapping = &#123;
        name index:<span class="java&#45;keyword">true</span>, indexAttributes: &#91;unique:<span class="java&#45;keyword">true</span>, dropDups:<span class="java&#45;keyword">true</span>&#93;
    &#125;
&#125;</pre></div><p class="paragraph"/>You can use MongoDB <a href="http://docs.mongodb.org/manual/reference/operator/meta/hint/" target="blank">Query Hints</a> by passing the <code>hint</code> argument to any dynamic finder:<p class="paragraph"/><div class="code"><pre>def people = Person.findByName(<span class="java&#45;quote">"Bob"</span>, &#91;hint:&#91;name:1&#93;&#93;)</pre></div><p class="paragraph"/>Or in a criteria query using the query "arguments" method<p class="paragraph"/><div class="code"><pre>Person.withCriteria &#123;
	eq 'firstName', 'Bob'
    arguments hint:&#91;<span class="java&#45;quote">"firstName"</span>:1&#93;
&#125;</pre></div><p class="paragraph"/><h4>Compound Indices</h4><p class="paragraph"/>MongoDB supports the notion of <a href="http://docs.mongodb.org/manual/core/index-compound/" target="blank">compound keys</a>. GORM for MongoDB enables this feature at the mapping level using the <code>compoundIndex</code> mapping:<p class="paragraph"/><div class="code"><pre>class Person &#123;
    &#8230;
    <span class="java&#45;keyword">static</span> mapping = &#123;
        compoundIndex name:1, age:&#45;1
    &#125;
&#125;</pre></div><p class="paragraph"/>As per the MongoDB docs 1 is for ascending and -1 is for descending.<p class="paragraph"/><h4>Indexing using the 'index' method</h4><p class="paragraph"/>In addition to the convenience features described above you can use the <code>index</code> method to define any index you want. For example:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> mapping = &#123;
    index( &#91;<span class="java&#45;quote">"person.address.postCode"</span>:1&#93;, &#91;unique:<span class="java&#45;keyword">true</span>&#93; )
&#125;</pre></div><p class="paragraph"/>In the above example I define an index on an embedded attribtue of the document. In fact what arguments you pass to the <code>index</code> method get passed to the underlying MongoDB <a href="http://api.mongodb.org/java/2.12/com/mongodb/DBCollection.html#createIndex(com.mongodb.DBObject,%20com.mongodb.DBObject)" target="blank">createIndex</a> method.


<h2 id="writeConcern">3.3 Customizing the WriteConcern</h2>
A feature of MongoDB is its ability to customize how important a database write is to the user. The Java client models this as a <a href="http://api.mongodb.org/java/current/com/mongodb/WriteConcern.html" target="blank">WriteConcern</a> and there are various options that indicate whether the client cares about server or network errors, or whether the data has been successfully written or not.<p class="paragraph"/>If you wish to customize the <code>WriteConcern</code> for a domain class you can do so in the mapping block:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> com.mongodb.WriteConcern<p class="paragraph"/>class Person &#123;
    <span class="java&#45;object">String</span> name
    <span class="java&#45;keyword">static</span> mapping = &#123;
        writeConcern WriteConcern.FSYNC_SAFE
    &#125;
&#125;</pre></div><p class="paragraph"/><blockquote class="note">
For versioned entities, if a lower level of WriteConcern than WriteConcern.ACKNOWLEDGE is specified, WriteConcern.ACKNOWLEDGE will also be used for updates, to ensure that optimistic locking failures are reported.
</blockquote>


<h2 id="dynamicAttributes">3.4 Dynamic Attributes</h2>
Unlike a relational database, MongoDB allows for "schemaless" persistence where there are no limits to the number of attributes a particular document can have. A GORM domain class on the other hand has a schema in that there are a fixed number of properties. For example consider the following domain class:<p class="paragraph"/><div class="code"><pre>class Plant &#123;
    <span class="java&#45;object">boolean</span> goesInPatch
    <span class="java&#45;object">String</span> name
&#125;</pre></div><p class="paragraph"/>Here there are two fixed properties, <code>name</code> and <code>goesInPatch</code>, that will be persisted into the Mongo document. Using GORM for Mongo you can however use dynamic properties via the Groovy subscript operator. For example:<p class="paragraph"/><div class="code"><pre>def p = <span class="java&#45;keyword">new</span> Plant(name:<span class="java&#45;quote">"Pineapple"</span>)
p&#91;'color'&#93; = 'Yellow'
p&#91;'hasLeaves'&#93; = <span class="java&#45;keyword">true</span>
p.save()<p class="paragraph"/>p = Plant.findByName(<span class="java&#45;quote">"Pineapple"</span>)<p class="paragraph"/>println p&#91;'color'&#93;
println p&#91;'hasLeaves'&#93;</pre></div><p class="paragraph"/>Using the subscript operator you can add additional attributes to the underlying <code>DBObject</code> instance that gets persisted to the MongoDB allowing for more dynamic domain models.


<h2 id="geoSpatial">3.5 Geospacial Querying</h2>
MongoDB supports storing <a href="http://docs.mongodb.org/manual/applications/geospatial-indexes/" target="blank">Geospacial data</a> in both flat and spherical surface types.<p class="paragraph"/>To store data in a flat surface you use a "2d" index, whilst a "2dsphere" index used for spherical data. GORM for MongoDB supports both and the following sections describe how to define and query Geospacial data.<p class="paragraph"/>


<h2 id="2dsphere">3.5.1 Geospacial 2D Sphere Support</h2>
<h4>Using a 2dsphere Index</h4><p class="paragraph"/>MongoDB's <a href="http://docs.mongodb.org/manual/core/2dsphere/" target="blank">2dsphere indexes</a> support queries that calculate geometries on an earth-like sphere.<p class="paragraph"/>Although you can use coordinate pairs in a 2dsphere index, they are considered legacy by the MongoDB documentation and it is recommended you store data using <a href="http://geojson.org/geojson-spec.html#id2" target="blank">GeoJSON Point</a> types.<p class="paragraph"/><blockquote class="warning">
MongoDB legacy coordinate pairs are in latitude / longitude order, whilst GeoJSON points are stored in longitude / latitude order!
</blockquote><p class="paragraph"/>To support this GORM for MongoDB features a special type, <code>grails.mongodb.geo.Point</code>, that can be use within domain classes to store geospacial data:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.mongodb.geo.&#42;
&#8230;
class Restaurant &#123;
    ObjectId id
    Point location<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        location geoIndex:'2dsphere'
    &#125;
&#125;</pre></div><p class="paragraph"/>The <code>Point</code> type gets persisted as a <a href="http://geojson.org/geojson-spec.html#id2" target="blank">GeoJSON Point</a>. A <code>Point</code> can be constructed from coordinate represented in longitude and latitude (the inverse of 2d index location coordinates!). Example:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">new</span> Restaurant(id:<span class="java&#45;quote">"Dan's Burgers"</span>, location: <span class="java&#45;keyword">new</span> Point(50, 50)).save(flush:<span class="java&#45;keyword">true</span>)<p class="paragraph"/>Restaurant.findByLocation(<span class="java&#45;keyword">new</span> Point(50,50))</pre></div><p class="paragraph"/><h4>Querying a 2sphere Index</h4><p class="paragraph"/>Once the 2sphere index is in place you can use various MongoDB plugin specific dynamic finders to query, including:
<ul class="star">
<li><strong class="bold">findBy...GeoWithin</strong> - Find out whether a <code>Point</code> is within a <code>Box</code>, <code>Polygon</code>, <code>Circle</code> or <code>Sphere</code></li>
<li><strong class="bold">findBy...GeoIntersects</strong> - Find out whether a <code>Point</code> is within a <code>Box</code>, <code>Polygon</code>, <code>Circle</code> or <code>Sphere</code></li>
<li><strong class="bold">findBy...Near</strong> - Find out whether any GeoJSON <code>Shape</code> is near the given <code>Point</code></li>
<li><strong class="bold">findBy...NearSphere</strong> - Find out whether any GeoJSON <code>Shape</code> is near the given <code>Point</code> using spherical geometry.</li>
</ul><p class="paragraph"/>Some examples:<p class="paragraph"/><div class="code"><pre>Restaurant.findByLocationGeoWithin( Polygon.valueOf(&#91; &#91;0, 0&#93;, &#91;100, 0&#93;, &#91;100, 100&#93;, &#91;0, 100&#93;, &#91;0, 0&#93; &#93;) )
Restaurant.findByLocationGeoWithin( Box.valueOf( &#91;&#91;25, 25&#93;, &#91;100, 100&#93;&#93; ) )
Restaurant.findByLocationGeoWithin( Circle.valueOf( &#91;&#91;50, 50&#93;, 100&#93; ) )
Restaurant.findByLocationGeoWithin( Sphere.valueOf( &#91;&#91;50, 50&#93;, 0.06&#93;) )
Restaurant.findByLocationNear( Point.valueOf( 40, 40 ) )</pre></div><p class="paragraph"/><blockquote class="note">
Note that a <code>Sphere</code> differs from a <code>Circle</code> in that the radius is specified in <a href="http://docs.mongodb.org/manual/tutorial/calculate-distances-using-spherical-geometry-with-2d-geospatial-indexes/" target="blank">radians</a>.
There is a special <code>Distance</code> class that can help with radian calculation.
</blockquote><p class="paragraph"/><h4>Native Querying Support</h4><p class="paragraph"/>In addition to being able to pass any <code>Shape</code> to geospacial query methods you can also pass a map that represents the native values to be passe to the underlying query. For example:<p class="paragraph"/><div class="code"><pre>def results = Restaurant.findAllByLocationNear( &#91;$geometry: &#91;type:'Point', coordinates: &#91;1,7&#93;&#93;, $maxDistance:30000&#93; )</pre></div><p class="paragraph"/>In the above example the native query parameters are simply passed to the <a href="http://docs.mongodb.org/manual/reference/operator/query/near/#op._S_near" target="blank">$near query</a><p class="paragraph"/>



<h2 id="2dindex">3.5.2 Geospacial 2D Index Support</h2>
MongoDB supports <a href="http://docs.mongodb.org/manual/core/2d/" target="blank">2d indexes</a> that store points on a two-dimensional plane.<p class="paragraph"/>It is possible to use a MongoDB 2d index by mapping a list or map property using the <code>geoIndex</code> mapping:<p class="paragraph"/><div class="code"><pre>class Hotel &#123;
    <span class="java&#45;object">String</span> name
    List location<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        location geoIndex:'2d'
    &#125;
&#125;</pre></div><p class="paragraph"/>By default the index creation assumes latitude/longitude and thus is configured for a -180..180 range. If you are indexing something else you can customise this with <code>indexAttributes</code><p class="paragraph"/><div class="code"><pre>class Hotel &#123;
    <span class="java&#45;object">String</span> name
    List location<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        location geoIndex:'2d', indexAttributes:&#91;min:&#45;500, max:500&#93;
    &#125;
&#125;</pre></div><p class="paragraph"/>You can then save Geo locations using a two dimensional list:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">new</span> Hotel(name:<span class="java&#45;quote">"Hilton"</span>, location:&#91;50, 50&#93;).save()</pre></div><p class="paragraph"/>Alternatively you can use a map with keys representing latitude and longitude:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">new</span> Hotel(name:<span class="java&#45;quote">"Hilton"</span>, location:&#91;lat: 40.739037d, <span class="java&#45;object">long</span>: 73.992964d&#93;).save()</pre></div><p class="paragraph"/><blockquote class="note">
You must specify whether the number of a floating point or double by adding a 'd' or 'f' at the end of the number eg. 40.739037d. Groovy's default type for decimal numbers is <code>BigDecimal</code> which is not supported by MongoDB.
</blockquote><p class="paragraph"/>Once you have your data indexed you can use Mongo specific dynamic finders to find hotels near a given a location:<p class="paragraph"/><div class="code"><pre>def h = Hotel.findByLocationNear(&#91;50, 60&#93;)
assert h.name == 'Hilton'</pre></div><p class="paragraph"/>You can also find a location within a box (bound queries). Boxes are defined by specifying the lower-left and upper-right corners:<p class="paragraph"/><div class="code"><pre>def box = &#91;&#91;40.73083d, &#45;73.99756d&#93;, &#91;40.741404d,  &#45;73.988135d&#93;&#93;
def h = Hotel.findByLocationWithinBox(box)</pre></div><p class="paragraph"/>You can also find a location within a circle. Circles are specified using a center and radius:<p class="paragraph"/><div class="code"><pre>def center = &#91;50, 50&#93;
def radius = 10
def h = Hotel.findByLocationWithinCircle(&#91;center, radius&#93;)</pre></div><p class="paragraph"/>If you plan on querying a location and some other value it is recommended to use a compound index:<p class="paragraph"/><div class="code"><pre>class Hotel &#123;
    <span class="java&#45;object">String</span> name
    List location
    <span class="java&#45;object">int</span> stars<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        compoundIndex location:<span class="java&#45;quote">"2d"</span>, stars:1
    &#125;
&#125;</pre></div><p class="paragraph"/>In the example above you an index is created for both the location and the number of stars a <code>Hotel</code> has.



<h2 id="geoJson">3.5.3 GeoJSON Data Models</h2>
You can also store any GeoJSON shape using the <code>grails.mongodb.geo.Shape</code> super class:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.mongodb.geo.&#42;
&#8230;
class Entry &#123;
    ObjectId id
    Shape shape<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        location geoIndex:'2dsphere'
    &#125;
&#125;
&#8230;
<span class="java&#45;keyword">new</span> Entry(shape: Polygon.valueOf(&#91;&#91;&#91;3, 1&#93;, &#91;1, 2&#93;, &#91;5, 6&#93;, &#91;9, 2&#93;, &#91;4, 3&#93;, &#91;3, 1&#93;&#93;&#93;) ).save()
<span class="java&#45;keyword">new</span> Entry(shape: LineString.valueOf(&#91;&#91;5, 2&#93;, &#91;7, 3&#93;, &#91;7, 5&#93;, &#91;9, 4&#93;&#93;) ).save()
<span class="java&#45;keyword">new</span> Entry(shape: Point.valueOf(&#91;5, 2&#93;)).save()</pre></div><p class="paragraph"/>And then use the <code>findBy*GeoIntersects</code> method to figure out whether shapes intersect with each other:<p class="paragraph"/><div class="code"><pre>assert Entry.findByShapeGeoIntersects( Polygon.valueOf( &#91;&#91; &#91;0,0&#93;, &#91;3,0&#93;, &#91;3,3&#93;, &#91;0,3&#93;, &#91;0,0&#93; &#93;&#93; ) )
assert Entry.findByShapeGeoIntersects( LineString.valueOf( &#91;&#91;1,4&#93;, &#91;8,4&#93;&#93; ) )</pre></div>



<h2 id="textSearch">3.6 Full Text Search</h2>
Using MongoDB 2.6 and above you can create <a href="http://docs.mongodb.org/manual/reference/operator/query/text/#op._S_text" target="blank">full text search</a> indices.<p class="paragraph"/>To create a "text" index using the <code>index</code> method inside the <code>mapping</code> block:<p class="paragraph"/><div class="code"><pre>class Product &#123;
    ObjectId id
    <span class="java&#45;object">String</span> title<p class="paragraph"/>    <span class="java&#45;keyword">static</span> mapping = &#123;
        index title:<span class="java&#45;quote">"text"</span>
    &#125;
&#125;</pre></div><p class="paragraph"/>You can then search for instances using the <code>search</code> method:<p class="paragraph"/><div class="code"><pre>assert Product.search(<span class="java&#45;quote">"bake coffee cake"</span>).size() == 10
assert Product.search(<span class="java&#45;quote">"bake coffee &#45;cake"</span>).size() == 6</pre></div><p class="paragraph"/>You can search for the top results by rank using the <code>searchTop</code> method:<p class="paragraph"/><div class="code"><pre>assert Product.searchTop(<span class="java&#45;quote">"cake"</span>).size() == 4
assert Product.searchTop(<span class="java&#45;quote">"cake"</span>,3).size() == 3</pre></div><p class="paragraph"/>And count the number of hits with the <code>countHits</code> method:<p class="paragraph"/><div class="code"><pre>assert Product.countHits('coffee') == 5</pre></div>


<h2 id="customTypes">3.7 Custom User Types</h2>
GORM for MongoDB will persist all common known Java types like String, Integer, URL etc., however if you want to persist one of your own classes that is not a domain class you can implement a custom user type.<p class="paragraph"/>For example consider the following class:<p class="paragraph"/><div class="code"><pre>class Birthday <span class="java&#45;keyword">implements</span> Comparable&#123;
    Date date<p class="paragraph"/>    Birthday(Date date) &#123;
        <span class="java&#45;keyword">this</span>.date = date
    &#125;<p class="paragraph"/>    @Override
    <span class="java&#45;object">int</span> compareTo(<span class="java&#45;object">Object</span> t) &#123;
        date.compareTo(t.date)
    &#125;
&#125;</pre></div><p class="paragraph"/><blockquote class="note">
Custom types should go in src/groovy not grails-app/domain
</blockquote><p class="paragraph"/>If you attempt to reference this class from a domain class it will not automatically be persisted for you. However you can create a custom type implementation and register it with Spring. For example:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> org.bson.&#42;
<span class="java&#45;keyword">import</span> org.grails.datastore.mapping.engine.types.AbstractMappingAwareCustomTypeMarshaller;
<span class="java&#45;keyword">import</span> org.grails.datastore.mapping.model.PersistentProperty;
<span class="java&#45;keyword">import</span> org.grails.datastore.mapping.mongo.query.MongoQuery;
<span class="java&#45;keyword">import</span> org.grails.datastore.mapping.query.Query;<p class="paragraph"/>class BirthdayType <span class="java&#45;keyword">extends</span> AbstractMappingAwareCustomTypeMarshaller&#60;Birthday, Document, Document&#62;(Birthday) &#123;
   @Override
   <span class="java&#45;keyword">protected</span> <span class="java&#45;object">Object</span> writeInternal(PersistentProperty property, <span class="java&#45;object">String</span> key, Birthday value, Document nativeTarget) &#123;
       <span class="java&#45;keyword">final</span> converted = value.date.time
       nativeTarget.put(key, converted)
       <span class="java&#45;keyword">return</span> converted
   &#125;<p class="paragraph"/>   @Override
   <span class="java&#45;keyword">protected</span> void queryInternal(PersistentProperty property, <span class="java&#45;object">String</span> key, PropertyCriterion criterion, Document nativeQuery) &#123;
       <span class="java&#45;keyword">if</span> (criterion <span class="java&#45;keyword">instanceof</span> Between) &#123;
           def dbo = <span class="java&#45;keyword">new</span> BasicDBObject()
           dbo.put(MongoQuery.MONGO_GTE_OPERATOR, criterion.getFrom().date.time)
           dbo.put(MongoQuery.MONGO_LTE_OPERATOR, criterion.getTo().date.time)
           nativeQuery.put(key, dbo)
       &#125;
       <span class="java&#45;keyword">else</span> &#123;
           nativeQuery.put(key, criterion.value.date.time)
       &#125;
   &#125;<p class="paragraph"/>   @Override
   <span class="java&#45;keyword">protected</span> Birthday readInternal(PersistentProperty property, <span class="java&#45;object">String</span> key, Document nativeSource) &#123;
       <span class="java&#45;keyword">final</span> num = nativeSource.get(key)
       <span class="java&#45;keyword">if</span> (num <span class="java&#45;keyword">instanceof</span> <span class="java&#45;object">Long</span>) &#123;
           <span class="java&#45;keyword">return</span> <span class="java&#45;keyword">new</span> Birthday(<span class="java&#45;keyword">new</span> Date(num))
       &#125;
       <span class="java&#45;keyword">return</span> <span class="java&#45;keyword">null</span>
   &#125;
&#125;)</pre></div><p class="paragraph"/>The above <code>BirthdayType</code> class is a custom user type implementation for MongoDB for the <code>Birthday</code> class. It provides implementations for three methods: <code>readInternal</code>, <code>writeInternal</code> and the optional <code>queryInternal</code>. If you do not implement <code>queryInternal</code> your custom type can be persisted but not queried.<p class="paragraph"/>The <code>writeInternal</code> method gets passed the property, the key to store it under, the value and the native DBObject where the custom type is to be stored:<p class="paragraph"/><div class="code"><pre>@Override
<span class="java&#45;keyword">protected</span> <span class="java&#45;object">Object</span> writeInternal(PersistentProperty property, <span class="java&#45;object">String</span> key, Birthday value, DBObject nativeTarget) &#123;
    <span class="java&#45;keyword">final</span> converted = value.date.time
    nativeTarget.put(key, converted)
    <span class="java&#45;keyword">return</span> converted
&#125;</pre></div><p class="paragraph"/>You can then read the values of the custom type and register them with the <code>DBObject</code>. The <code>readInternal</code> method gets passed the <code>PersistentProperty</code>, the key the user type info is stored under (although you may want to use multiple keys) and the <code>DBObject</code>:<p class="paragraph"/><div class="code"><pre>@Override
<span class="java&#45;keyword">protected</span> Birthday readInternal(PersistentProperty property, <span class="java&#45;object">String</span> key, Document nativeSource) &#123;
    <span class="java&#45;keyword">final</span> num = nativeSource.get(key)
    <span class="java&#45;keyword">if</span>(num <span class="java&#45;keyword">instanceof</span> <span class="java&#45;object">Long</span>) &#123;
        <span class="java&#45;keyword">return</span> <span class="java&#45;keyword">new</span> Birthday(<span class="java&#45;keyword">new</span> Date(num))
    &#125;
    <span class="java&#45;keyword">return</span> <span class="java&#45;keyword">null</span>
&#125;</pre></div><p class="paragraph"/>You can then construct the custom type by reading values from the <code>DBObject</code>. Finally the <code>queryInternal</code> method allows you to handle how a custom type is queried:<p class="paragraph"/><div class="code"><pre>@Override
<span class="java&#45;keyword">protected</span> void queryInternal(PersistentProperty property, <span class="java&#45;object">String</span> key, Query.PropertyCriterion criterion, Document nativeQuery) &#123;
    <span class="java&#45;keyword">if</span>(criterion <span class="java&#45;keyword">instanceof</span> Between) &#123;
        def dbo = <span class="java&#45;keyword">new</span> BasicDBObject()
        dbo.put(MongoQuery.MONGO_GTE_OPERATOR, criterion.getFrom().date.time);
        dbo.put(MongoQuery.MONGO_LTE_OPERATOR, criterion.getTo().date.time);
        nativeQuery.put(key, dbo)
    &#125;
    <span class="java&#45;keyword">else</span> <span class="java&#45;keyword">if</span>(criterion <span class="java&#45;keyword">instanceof</span> Equals)&#123;
        nativeQuery.put(key, criterion.value.date.time)
    &#125;
    <span class="java&#45;keyword">else</span> &#123;
	    <span class="java&#45;keyword">throw</span> <span class="java&#45;keyword">new</span> RuntimeException(<span class="java&#45;quote">"unsupported query type <span class="java&#45;keyword">for</span> property $property"</span>)
    &#125;
&#125;</pre></div><p class="paragraph"/>The method gets passed a <code>criterion</code> which is the type of query and depending on the type of query you may handle the query differently. For example the above implementation supports <code>between</code> and <code>equals</code> style queries. So the following 2 queries will work:<p class="paragraph"/><div class="code"><pre>Person.findByBirthday(<span class="java&#45;keyword">new</span> Birthday(<span class="java&#45;keyword">new</span> Date()&#45;7)) // find someone who was born 7 days ago
Person.findByBirthdayBetween(<span class="java&#45;keyword">new</span> Birthday(<span class="java&#45;keyword">new</span> Date()&#45;7), <span class="java&#45;keyword">new</span> Birthday(<span class="java&#45;keyword">new</span> Date())) // find someone who was born in the last 7 days</pre></div><p class="paragraph"/>However "like" or other query types will not work.<p class="paragraph"/>To register a custom type in a grails application simply register it as Spring bean. For example, to register the above <code>BirthdayType</code> add the following to grails-app/conf/spring/resources.groovy:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> com.example.BirthdayType<p class="paragraph"/>// Place your Spring DSL code here
beans = &#123;
  birthdayType(BirthdayType)
&#125;</pre></div>



<h1 id="databaseSwitching">4 Switching Database or Collection at Runtime</h1>
In addition to storing dynamic attributes, as of version 1.3.0 of the plugin you can also switch which database and/or collection to persist to at runtime.<p class="paragraph"/>For example:<p class="paragraph"/><div class="code"><pre>Person.withDatabase(<span class="java&#45;quote">"administrators"</span>) &#123;
    <span class="java&#45;keyword">new</span> Person(name:<span class="java&#45;quote">"Bob"</span>).save()
&#125;</pre></div><p class="paragraph"/>The above example will save a <code>Person</code> instance to the 'administrators' database. The database is used for the scope of the closure. You can switch database for the scope of the active session:<p class="paragraph"/><div class="code"><pre>Person.useDatabase(<span class="java&#45;quote">"administrators"</span>) 
<span class="java&#45;keyword">new</span> Person(name:<span class="java&#45;quote">"Bob"</span>).save()</pre></div><p class="paragraph"/>In addition, there are equivalent <code>withCollection</code> and <code>useCollection</code> methods for switching collection at runtime.



<h1 id="stateless">5 Stateless Mode</h1>
GORM for MongoDB supports both stateless and stateful modes for mapping domain classes to MongoDB. In general stateful mapping is superior for write heavy applications and stateless mode better for read heavy applications (particularily when large amounts of data is involved).<p class="paragraph"/><h4>Stateful mode</h4><p class="paragraph"/>Domain classes are by default stateful, which means when they are read from a MongoDB document their state is stored in the user session (which is typically bound to the request in Grails). This has several advantages for write heavy applications:
<ul class="star">
<li>GORM can automatically detect whether a call to save() is a an update or an insert and act appropriately</li>
<li>GORM stores the state of the read MongoDB document and therefore updates to schemaless properties don't require an extra query</li>
<li>GORM can store the current version and therefore implement optimistic locking</li>
<li>Repeated reads of the same entity can be retrieved from the cache, thus optimizing reads as well</li>
</ul><p class="paragraph"/>For an example of when a stateful domain class is better consider the following:<p class="paragraph"/><div class="code"><pre>def b = Book.get(1)
b&#91;'pages'&#93; = 400
b&#91;'publisher'&#93; = 'Manning'
b&#91;'rating'&#93; = 5
b.save(flush:<span class="java&#45;keyword">true</span>)</pre></div><p class="paragraph"/>With a stateful entity the updates to the three properties can be batched up and executed in the save() call, when there is no state then 3 updates needs to be executed for each schemaless property (ouch!).<p class="paragraph"/>
<h4>Stateless Domain classes</h4><p class="paragraph"/>However, stateful domain classes can cause problems for read-heavy applications. Take for example the following code:<p class="paragraph"/><div class="code"><pre>def books = Book.list() // read 100,000 books
<span class="java&#45;keyword">for</span>(b in books) &#123;
    println b.title
&#125;</pre></div><p class="paragraph"/>The above example will read 100,000 books and print the title of each. In stateful mode this will almost certainly run out of memory as each MongoDB document is stored in user memory as is each book. Rewriting the code as follows will solve the problem:<p class="paragraph"/><div class="code"><pre>Book.withStatelessSession &#123;
    def books = Book.list() // read 100,000 books
    <span class="java&#45;keyword">for</span>(b in books) &#123;
        println b.title
    &#125;    
&#125;</pre></div><p class="paragraph"/>Alternatively you can map the domain class as stateless, in which case its state will never be stored in the session:<p class="paragraph"/><div class="code"><pre>class Book &#123;
    &#8230;
    <span class="java&#45;keyword">static</span> mapping = &#123;
        stateless <span class="java&#45;keyword">true</span>
    &#125;
&#125;</pre></div><p class="paragraph"/><h4>Disadvantages of Stateless Mode</h4><p class="paragraph"/>There are several disadvantages to using stateless domain classes as the default. One disadvantage is that if you are using assigned identifiers GORM cannot detect whether you want to do an insert or an update so you have to be explicit about which one you want:<p class="paragraph"/><div class="code"><pre>def b = <span class="java&#45;keyword">new</span> Book(id:<span class="java&#45;quote">"The Book"</span>)
b.insert()</pre></div><p class="paragraph"/>In the above case we use the explicit 'insert' method to tell Grails this is an insert not an udpate. Another disadvantage is that reading of schemaless/dynamic properties is more costly. For example:<p class="paragraph"/>
<div class="code"><pre>def books = Book.list() // read 100,000 books
<span class="java&#45;keyword">for</span>(b in books) &#123;
    println b&#91;'pages'&#93;
    println b&#91;'rating'&#93;
&#125;</pre></div><p class="paragraph"/>Here GORM has to execute an additional read method for each schemaless property! This is better written as:<p class="paragraph"/><div class="code"><pre>def books = Book.list() // read 100,000 books
<span class="java&#45;keyword">for</span>(b in books) &#123;
    def dbo = b.dbo
    println dbo&#91;'pages'&#93;
    println dbo&#91;'rating'&#93;
&#125;</pre></div><p class="paragraph"/>Thus only requiring one query. Or alternatively you can use the native API:<p class="paragraph"/><div class="code"><pre>def books = Book.collection.find() // read 100,000 books
<span class="java&#45;keyword">for</span>(dbo in books) &#123;
    Book b = dbo as Book    
    println dbo&#91;'pages'&#93;
    println dbo&#91;'rating'&#93;
&#125;</pre></div><p class="paragraph"/>Which would be more efficient.<p class="paragraph"/>



<h1 id="lowLevelApi">6 Using the Mongo Driver Directly</h1>
A lower level API is provided by the plugin via the Mongo driver<p class="paragraph"/><blockquote class="note">
There is an excellent tutorial on how to use the Mongo Java driver's API directly in the <a href="http://www.mongodb.org/display/DOCS/Java+Tutorial" target="blank">Mongo documentation</a>
</blockquote><p class="paragraph"/>An example can be seen below:<p class="paragraph"/><div class="code"><pre>// Get a db reference in the old fashion way
def db = mongo.getDB(<span class="java&#45;quote">"mydb"</span>)<p class="paragraph"/>// Insert a document
db.languages.insert(&#91;name: 'Groovy'&#93;)
// A less verbose way to <span class="java&#45;keyword">do</span> it
db.languages.insert(name: 'Ruby')
// Yet another way
db.languages &#60;&#60; &#91;name: 'Python'&#93;<p class="paragraph"/>// Insert a list of documents
db.languages &#60;&#60; &#91;&#91;name: 'Javascript', type: 'prototyped'&#93;, &#91;name: 'Ioke', type: 'prototyped'&#93;&#93;</pre></div><p class="paragraph"/>
To get hold of the <code>mongo</code> instance (which is an instance of the <a href="http://api.mongodb.org/java/current/com/mongodb/Mongo.html" target="blank">com.mongodb.Mongo</a> class) inside a controller or service simple define a <code>mongo</code> property:<p class="paragraph"/><div class="code"><pre>def mongo
def myAction = &#123;
    def db = mongo.getDB(<span class="java&#45;quote">"mongo"</span>)
    db.languages.insert(&#91;name: 'Groovy'&#93;)
&#125;</pre></div><p class="paragraph"/>A request scoped bean is also available for the default database (typically the name of your application, unless specified by the <code>databaseName</code> config option, plus the suffix "DB").<p class="paragraph"/><div class="code"><pre>def peopleDB
def myAction = &#123;
    peopleDB.languages.insert(&#91;name: 'Fred'&#93;)
&#125;</pre></div><p class="paragraph"/>Each domain class you define also has a <code>collection</code> property that allows easy access to the underlying <code>Collection</code> instance:<p class="paragraph"/><div class="code"><pre>Person.collection.count() == 1
Person.collection.findOne(firstName:<span class="java&#45;quote">"Fred"</span>).lastName == <span class="java&#45;quote">"Flintstone"</span></pre></div><p class="paragraph"/>You can easily convert from a native MongoDB <code>DBObject</code> into an entity using a cast:<p class="paragraph"/><div class="code"><pre>def fred = Person.collection.findOne(firstName:<span class="java&#45;quote">"Fred"</span>) as Person</pre></div>


<h1 id="transactions">7 Transactions</h1>
MongoDB doesn't support transactions directly, however GORM for MongoDB does batch up inserts and updates until the session is flushed. This makes it possible to support some rollback options.<p class="paragraph"/>You can use either transactional services or the static <code>withTransaction</code> method. To mark a service as using the MongoDB transaction manager, use the static <code>transactional</code> property with the value <code>'mongo'</code>:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">static</span> transactional = 'mongo'</pre></div><p class="paragraph"/>Alternately you can do ad-hoc transactions using the <code>withTransaction</code> method:<p class="paragraph"/><div class="code"><pre>Person.withTransaction &#123; status &#45;&#62;
    <span class="java&#45;keyword">new</span> Person(name:<span class="java&#45;quote">"Bob"</span>, age:50).save()
    <span class="java&#45;keyword">throw</span> <span class="java&#45;keyword">new</span> RuntimeException(<span class="java&#45;quote">"bad"</span>)
    <span class="java&#45;keyword">new</span> Person(name:<span class="java&#45;quote">"Fred"</span>, age:45).save()
&#125;</pre></div><p class="paragraph"/>For example in this case neither <code>Person</code> object will be persisted to the database, because underneath the surface a persistence session is being used to batch up both insert operations into a single insert. When an exception is thrown neither insert is ever executed, hence we allow for some transactional semantics at the GORM-level.<p class="paragraph"/>Using the lower level API you can of course also take advantage of Mongo's support for <a href="http://docs.mongodb.org/manual/tutorial/isolate-sequence-of-operations" target="blank">Atomic operations</a>.



<h1 id="testing">8 Unit Testing</h1>
For many simple cases you can use the built in <a href="http://grails.org/doc/latest/guide/testing.html#unitTestingDomains" target="blank">GORM unit testing</a> provided by Grails.<p class="paragraph"/>For more complex cases a <code>grails.test.mixin.mongodb.MongoDbTestMixin</code> class is provided which can run tests against a running MongoDB instance or a mock instance (such as one provided by the <a href="https://github.com/fakemongo/fongo" target="blank">Fongo</a> project).<p class="paragraph"/>Example against a running MongoDB instance:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> org.bson.types.ObjectId<p class="paragraph"/>@Entity
class Person &#123;
    ObjectId id
    <span class="java&#45;object">Long</span> version
    <span class="java&#45;object">String</span> name
&#125;<p class="paragraph"/>...<p class="paragraph"/><span class="java&#45;keyword">import</span> grails.test.mixin.mongodb.&#42;<p class="paragraph"/>@TestMixin(MongoDbTestMixin)
class PersonSpec <span class="java&#45;keyword">extends</span> Specification&#123;<p class="paragraph"/>    void <span class="java&#45;quote">"Test count people"</span>() &#123;
        given:<span class="java&#45;quote">"A mongo domain model"</span>
            mongoDomain(&#91;Person&#93;)<p class="paragraph"/>        expect:<span class="java&#45;quote">"Count the number of people"</span>
            Person.count() == 0
    &#125;
&#125;</pre></div><p class="paragraph"/>
Example using <a href="https://github.com/fakemongo/fongo" target="blank">Fongo</a>:<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> com.github.fakemongo.Fongo
<span class="java&#45;keyword">import</span> grails.test.mixin.mongodb.&#42;<p class="paragraph"/>@TestMixin(MongoDbTestMixin)
class PersonSpec <span class="java&#45;keyword">extends</span> Specification&#123;<p class="paragraph"/>    void <span class="java&#45;quote">"Test count people"</span>() &#123;
        given:<span class="java&#45;quote">"A mongo domain model"</span>
            Fongo fongo = <span class="java&#45;keyword">new</span> Fongo(<span class="java&#45;quote">"mongo server 1"</span>);
            mongoDomain(fongo.mongo, &#91;Person&#93;)<p class="paragraph"/>        expect:<span class="java&#45;quote">"Count the number of people"</span>
            Person.count() == 0
    &#125;
&#125;</pre></div><p class="paragraph"/>
This library dependency is required in <code>build.gradle</code> for adding support for <code>MongoDbTestMixin</code>.<p class="paragraph"/><div class="code"><pre>dependencies &#123;
        test 'org.grails:grails&#45;datastore&#45;test&#45;support:5.0.0'
    &#125;</pre></div><p class="paragraph"/>Fongo dependency example
<div class="code"><pre>dependencies &#123;
        test 'com.github.fakemongo:fongo:1.5.4'
    &#125;</pre></div><p class="paragraph"/>
<h4>Configuring domain classes for MongoDbTestMixin tests with the Domain annotation</h4><p class="paragraph"/>The <code>grails.test.mixin.gorm.Domain</code> annotation is used to configure the list of domain classes that gets configured when the unit test runtime is initialized.<p class="paragraph"/><code>Domain</code> annotations will be collected from several locations:
<ul class="star">
<li>the annotations on the test class</li>
<li>the package annotations in the package-info.java/package-info.groovy file in the package of the test class</li>
<li>each super class of the test class and their respective package annotations</li>
<li>the possible <code>api:grails.test.runtime.SharedRuntime</code> class</li>
</ul><p class="paragraph"/><code>Domain</code> annotations can be shared by adding them as package annotations to package-info.java/package-info.groovy files or by adding them to a <code>api:grails.test.runtime.SharedRuntime</code> class which has been added for the test.<p class="paragraph"/>It's not possible to use DomainClassUnitTestMixin's <code>Mock</code> annotation in MongoDbTestMixin tests. Use the <code>Domain</code> annotation in the place of <code>Mock</code> in MongoDbTestMixin tests.<p class="paragraph"/>Example:
<div class="code"><pre><span class="java&#45;keyword">import</span> grails.test.mixin.TestMixin
<span class="java&#45;keyword">import</span> grails.test.mixin.gorm.Domain
<span class="java&#45;keyword">import</span> spock.lang.Specification<p class="paragraph"/>
@Domain(Person)
@TestMixin(MongoDbTestMixin)
class DomainAnnotationSpec <span class="java&#45;keyword">extends</span> Specification&#123;
    void <span class="java&#45;quote">"should allow registering domains with Domain annotation"</span>() &#123;
        given:
            def person = <span class="java&#45;keyword">new</span> Person(name:'John Doe')
            def personId = person.save(flush:<span class="java&#45;keyword">true</span>, failOnError:<span class="java&#45;keyword">true</span>)?.id
        expect:<span class="java&#45;quote">"Dynamic finders to work"</span>
            Person.count() &#62; 0
            Person.get(personId).name == 'John Doe'
    &#125;
&#125;</pre></div>

                    </div>
                </td>
                <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Beans</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../ref/Beans/mongo.html">mongo</a>
                        </div>
                        
                        </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Domain Classes</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/DB.html">DB</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/collection.html">collection</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/collectionName.html">collectionName</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/countHits.html">countHits</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/dbo.html">dbo</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/findByGeoIntersects.html">findByGeoIntersects</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/findByGeoWithin.html">findByGeoWithin</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/findByNear.html">findByNear</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/findByNearSphere.html">findByNearSphere</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/findByWithinBox.html">findByWithinBox</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/findByWithinCircle.html">findByWithinCircle</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/search.html">search</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/searchTop.html">searchTop</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/useCollection.html">useCollection</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/useDatabase.html">useDatabase</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/withCollection.html">withCollection</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Domain%20Classes/withDatabase.html">withDatabase</a>
                        </div>
                        
                        </div>
                    </div>
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Testing</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../ref/Testing/MongoDbTestMixin.html">MongoDbTestMixin</a>
                        </div>
                        
                        </div>
                    </div>
                    
                </div>
            </div>
        </td>
            </tr>
        </table>

        <div id="footer">
            
            
        </div>



<script type="text/javascript" src="../js/docs.js"></script>

    </body>
</html>
